===== Package.swift =====
// swift-tools-version: 6.0

// WARNING:
// This file is automatically generated.
// Do not edit it by hand because the contents will be replaced.

import PackageDescription
import AppleProductTypes

let package = Package(
    name: "DogsAID",
    platforms: [
        .iOS("17.0")
    ],
    products: [
        .iOSApplication(
            name: "DogsAID",
            targets: ["AppModule"],
            bundleIdentifier: "com.harshwardhan.DogsAID",
            teamIdentifier: "YD8V4N5AAK",
            displayVersion: "1.0",
            bundleVersion: "1",
            appIcon: .asset("AppIcon"),
            accentColor: .presetColor(.blue),
            supportedDeviceFamilies: [
                .pad,
                .phone
            ],
            supportedInterfaceOrientations: [
                .portrait,
                .landscapeRight,
                .landscapeLeft,
                .portraitUpsideDown(.when(deviceFamilies: [.pad]))
            ]
        )
    ],
    targets: [
        .executableTarget(
            name: "AppModule",
            path: "Sources/AppModule",
            resources: [
                .copy("Resources/Assets.xcassets")
            ]
        )
    ],
    swiftLanguageModes: [.version("6")]
)

===== Sources/AppModule/App/ContentView.swift =====
import SwiftUI

struct ContentView: View {
    @AppStorage("hasSeenDisclaimer") private var hasSeenDisclaimer = false
    @State private var showDisclaimerSheet = false

    var body: some View {
        RootTabView()
            .task {
                try? await Task.sleep(nanoseconds: 1_600_000_000)
                if !hasSeenDisclaimer {
                    showDisclaimerSheet = true
                }
            }
            .sheet(isPresented: $showDisclaimerSheet) {
                DisclaimerView {
                    showDisclaimerSheet = false
                    hasSeenDisclaimer = true
                }
                .interactiveDismissDisabled(true)
                .presentationDetents([.large])
                .presentationDragIndicator(.hidden)
            }
    }
}

===== Sources/AppModule/App/PetAIDApp.swift =====
import SwiftUI

@main
struct DogsAIDApp: App {
    var body: some Scene {
        WindowGroup {
        ContentView()

        }
    }
}

===== Sources/AppModule/App/RootTabView.swift =====
import SwiftUI

struct RootTabView: View {

    @State private var selectedTab: Int = 0

    var body: some View {
        if #available(iOS 26.0, *) {
            TabView(selection: $selectedTab) {

                Tab("Emergency", systemImage: "cross.case.fill", value: 0) {
                    NavigationStack {
                        EmergencyHomeView()
                    }
                }

                Tab("Checklist", systemImage: "checklist", value: 1) {
                    NavigationStack {
                        ChecklistView()
                            .navigationTitle("Checklist")
                    }
                }
            }
            .tabViewStyle(.sidebarAdaptable)

        } else {
            TabView {
                NavigationStack {
                    EmergencyHomeView()
                }
                .tabItem { Label("Emergency", systemImage: "cross.case.fill") }

                NavigationStack {
                    ChecklistView()
                        .navigationTitle("Checklist")
                }
                .tabItem { Label("Checklist", systemImage: "checklist") }
            }
        }
    }
}

===== Sources/AppModule/Core/Audio/AudioCueManager.swift =====
import AVFoundation

@MainActor
final class AudioCueManager: NSObject, ObservableObject {

    private let synthesizer = AVSpeechSynthesizer()

    // MARK: Callbacks

    var onFinished  : (() -> Void)?
    var onWillSpeak : ((NSRange, Int) -> Void)?

    // MARK: Private

    private var isCancelling             = false
    private var shouldDeactivateOnCancel = false
    private var currentTextLength        = 0

    override init() {
        super.init()
        synthesizer.delegate = self

        try? AVAudioSession.sharedInstance().setCategory(
            .playback,
            mode: .default,
            options: [.mixWithOthers, .duckOthers]
        )
        try? AVAudioSession.sharedInstance().setActive(true)

        NotificationCenter.default.addObserver(
            self,
            selector: #selector(handleInterruption),
            name: AVAudioSession.interruptionNotification,
            object: AVAudioSession.sharedInstance()
        )
    }

    @objc private func handleInterruption(_ notification: Notification) {
        guard
            let info      = notification.userInfo,
            let typeValue = info[AVAudioSessionInterruptionTypeKey] as? UInt,
            let type      = AVAudioSession.InterruptionType(rawValue: typeValue),
            type == .began
        else { return }
        pause()
    }

    // MARK: Public API

    func speak(_ text: String) {
        isCancelling             = true
        shouldDeactivateOnCancel = false
        synthesizer.stopSpeaking(at: .immediate)
        isCancelling             = false

        currentTextLength = text.count

        let utterance             = AVSpeechUtterance(string: text)
        utterance.voice           = AVSpeechSynthesisVoice(language: "en-US")
        utterance.rate            = 0.5
        utterance.pitchMultiplier = 1.5
        utterance.volume          = 0.8
        synthesizer.speak(utterance)
    }

    func pause() {
        isCancelling             = true
        shouldDeactivateOnCancel = false
        synthesizer.stopSpeaking(at: .immediate)
        isCancelling             = false
    }

    func stop() {
        isCancelling             = true
        shouldDeactivateOnCancel = true
        synthesizer.stopSpeaking(at: .immediate)

    }
}

// MARK: - AVSpeechSynthesizerDelegate

extension AudioCueManager: @preconcurrency AVSpeechSynthesizerDelegate {

    @MainActor func speechSynthesizer(
        _ synthesizer: AVSpeechSynthesizer,
        willSpeakRangeOfSpeechString characterRange: NSRange,
        utterance: AVSpeechUtterance
    ) {
        guard !isCancelling else { return }
        onWillSpeak?(characterRange, currentTextLength)
    }

    @MainActor func speechSynthesizer(
        _ synthesizer: AVSpeechSynthesizer,
        didFinish utterance: AVSpeechUtterance
    ) {
        if shouldDeactivateOnCancel {

            shouldDeactivateOnCancel = false
            isCancelling             = false
            return
        }
        guard !isCancelling else { return }
        DispatchQueue.main.async { [weak self] in
            self?.onFinished?()
        }
    }

    @MainActor func speechSynthesizer(
        _ synthesizer: AVSpeechSynthesizer,
        didCancel utterance: AVSpeechUtterance
    ) {
        if shouldDeactivateOnCancel {
            shouldDeactivateOnCancel = false
            isCancelling             = false
        }
    }
}

===== Sources/AppModule/Core/Audio/MetronomeManager.swift =====
import AVFoundation

final class MetronomeManager {

    private let engine     = AVAudioEngine()
    private let player     = AVAudioPlayerNode()
    private let sampleRate : Double = 44100
    private lazy var format     = AVAudioFormat(
        standardFormatWithSampleRate: sampleRate, channels: 1
    )!
    private lazy var beatBuffer : AVAudioPCMBuffer = makeBeatBuffer()

    private var timerSrc  : DispatchSourceTimer?
    private let timerQueue = DispatchQueue(label: "cpr.metronome", qos: .userInteractive)

    init() {
        engine.attach(player)
        engine.connect(player, to: engine.mainMixerNode, format: format)
    }

    // MARK: - Public API

    func start(bpm: Double) {
        stop()


        guard !engine.isRunning else { return }
        do {
            try engine.start()
        } catch {
            print("MetronomeManager: engine failed to start â€” \(error)")
            return
        }

        let interval = 60.0 / bpm
        let src = DispatchSource.makeTimerSource(queue: timerQueue)
        src.schedule(deadline: .now(), repeating: interval, leeway: .milliseconds(2))
        src.setEventHandler { [weak self] in
            guard let self, self.engine.isRunning else { return }
            self.player.scheduleBuffer(self.beatBuffer, at: nil, options: .interrupts)
            if !self.player.isPlaying { self.player.play() }
        }
        src.resume()
        timerSrc = src
    }

    func stop() {
        timerSrc?.cancel()
        timerSrc = nil
        if player.isPlaying { player.stop() }
        if engine.isRunning { engine.stop() }

    }

    // MARK: - Sound design

    private func makeBeatBuffer() -> AVAudioPCMBuffer {
        let duration     = 0.12
        let frames       = AVAudioFrameCount(sampleRate * duration)
        let buffer       = AVAudioPCMBuffer(pcmFormat: format, frameCapacity: frames)!
        buffer.frameLength = frames

        let data         = buffer.floatChannelData![0]
        let sr           = Float(sampleRate)
        let attackFrames = Int(sr * 0.002)

        for i in 0..<Int(frames) {
            let t = Float(i) / sr

            let envelope: Float
            if i < attackFrames {
                envelope = Float(i) / Float(attackFrames)
            } else {
                envelope = exp(-6.0 * Float(i - attackFrames) / (sr * Float(duration)))
            }

            let body      = sin(2 * .pi * 65  * t)
            let transient = sin(2 * .pi * 180 * t) * 0.4 * exp(-18.0 * t / Float(duration))

            data[i] = (body + transient) * envelope * 0.75
        }
        return buffer
    }
}

===== Sources/AppModule/Core/EmergencyFlow/EmergencyAudioEnvironment.swift =====
import SwiftUI

// MARK: - EmergencyAudioStopAction
struct EmergencyAudioStopAction {

    var action: () -> Void = {}

    func callAsFunction() { action() }
}

private struct EmergencyAudioStopKey: EnvironmentKey {
    nonisolated(unsafe) static let defaultValue = EmergencyAudioStopAction()
}

extension EnvironmentValues {
    var stopEmergencyAudio: EmergencyAudioStopAction {
        get { self[EmergencyAudioStopKey.self] }
        set { self[EmergencyAudioStopKey.self] = newValue }
    }
}

===== Sources/AppModule/Core/EmergencyFlow/EmergencyFlowView.swift =====
import SwiftUI
import Foundation

// MARK: - TTSCoordinator (unchanged)

@MainActor
final class TTSCoordinator: ObservableObject {

    @Published private(set) var currentIndex: Int = 0
    @Published private(set) var progress: Double = 0.0
    @Published private(set) var isSpeaking: Bool = false
    @Published private(set) var isPaused: Bool = false

    private var targetProgress: Double = 0.0
    private var displayTimer: Timer?
    private let smoothing: Double = 0.10

    func prepare(stepIndex: Int) {
        guard !isPaused else { return }
        stopTimer()
        currentIndex = stepIndex
        isSpeaking = true
        targetProgress = 0.0
        progress = 0.0
        startTimer()
    }

    func update(range: NSRange, totalCharacters: Int) {
        guard !isPaused else { return }
        let spoken = range.location + range.length
        targetProgress = min(Double(spoken) / Double(max(totalCharacters, 1)), 1.0)
    }

    func finish() {
        guard !isPaused else { return }
        targetProgress = 1.0
        Task { @MainActor in
            try? await Task.sleep(for: .milliseconds(400))
            self.progress = 1.0
            self.isSpeaking = false
            self.stopTimer()
        }
    }

    func pause() {
        isPaused = true
        isSpeaking = false
        stopTimer()
    }

    func resume() {
        isPaused = false
    }

    func reset() {
        stopTimer()
        targetProgress = 0.0
        progress = 0.0
        isSpeaking = false
        isPaused = false
    }

    private func startTimer() {
        displayTimer = Timer.scheduledTimer(
            withTimeInterval: 1.0 / 60.0,
            repeats: true
        ) { [weak self] _ in
            guard let self = self else { return }
            Task { @MainActor in self.tick() }
        }
        RunLoop.main.add(displayTimer!, forMode: .common)
    }

    private func stopTimer() {
        displayTimer?.invalidate()
        displayTimer = nil
    }

    private func tick() {
        guard isSpeaking, !isPaused else { return }
        let delta = targetProgress - progress
        guard abs(delta) > 0.001 else {
            if progress != targetProgress { progress = targetProgress }
            return
        }
        progress += delta * smoothing
    }
}

// MARK: - EmergencyFlowView

struct EmergencyFlowView<Step: EmergencyStep, InteractiveContent: View>: View {

    let steps: [Step]
    let navigationTitle: String
    var paginationAccentColor: Color = Color(red: 0.85, green: 0.15, blue: 0.15)
    @ViewBuilder private let interactiveContent: (Step, Bool) -> InteractiveContent

    @Environment(\.scenePhase) private var scenePhase

    @State private var index = 0
    @State private var didSwipeManually = false
    @State private var isPaused = false
    @State private var isActive = false
    @State private var advanceTask: Task<Void, Never>? = nil

    @StateObject private var audio = AudioCueManager()
    @StateObject private var tts = TTSCoordinator()

    init(
        steps: [Step],
        navigationTitle: String,
        paginationAccentColor: Color = Color(red: 0.85, green: 0.15, blue: 0.15),
        @ViewBuilder interactiveContent: @escaping (Step, Bool) -> InteractiveContent
    ) {
        self.steps = steps
        self.navigationTitle = navigationTitle
        self.paginationAccentColor = paginationAccentColor
        self.interactiveContent = interactiveContent
    }

    // MARK: Body

    var body: some View {
        TabView(selection: $index) {
            ForEach(steps.indices, id: \.self) { pageIndex in
                EmergencyPageView(
                    step: steps[pageIndex],
                    stepNumber: pageIndex + 1,
                    totalSteps: steps.count,
                    isPageVisible: pageIndex == index
                ) {
                    interactiveContent(steps[pageIndex], pageIndex == index)
                }
                .safeAreaInset(edge: .top, spacing: 0) {
                    Color.clear.frame(height: indicatorHeight)
                }
                .tag(pageIndex)
            }
        }
        .tabViewStyle(.page(indexDisplayMode: .never))
        .animation(.easeInOut(duration: 0.3), value: index)
        .overlay(alignment: .top) {
            VStack(spacing: 0) {
                EmergencyPaginationIndicator(
                    coordinator: tts,
                    total: steps.count,
                    accentColor: paginationAccentColor
                )
                Divider()
            }
            .background(Color(.systemBackground))
        }

        .environment(\.stopEmergencyAudio, EmergencyAudioStopAction {
            silenceAudio()
        })
        .onChange(of: index) { oldValue, newValue in
            guard isActive, !isPaused else { return }
            didSwipeManually = true
            speakStep(at: newValue)
        }
        .onAppear {
            isActive = true

            audio.onWillSpeak = { range, total in
                Task { @MainActor in
                    guard self.isActive else { return }
                    tts.update(range: range, totalCharacters: total)
                }
            }

            audio.onFinished = {
                Task { @MainActor in
                    guard self.isActive else { return }
                    tts.finish()
                    handleAudioFinished()
                }
            }

            speakStep(at: 0)
        }
        .onDisappear {
            teardown()
        }
        .background(Color(.systemBackground))
        .navigationTitle(navigationTitle)
        .navigationBarTitleDisplayMode(.inline)
        .toolbar {
            ToolbarItem(placement: .navigationBarTrailing) {
                Button {
                    if isPaused { resume() } else { pause() }
                } label: {
                    Image(systemName: isPaused ? "play.fill" : "pause.fill")
                        .font(.system(size: 14, weight: .semibold))
                        .foregroundStyle(isPaused ? .green : .secondary)
                        .animation(.easeInOut(duration: 0.2), value: isPaused)
                }
            }
        }
        .toolbar(.hidden, for: .tabBar)
        .onChange(of: scenePhase) { oldValue, newValue in
            if newValue != .active { teardown() }
        }
    }

    // MARK: - Teardown

    private func teardown() {
        isActive = false
        advanceTask?.cancel()
        advanceTask = nil
        audio.onFinished  = nil
        audio.onWillSpeak = nil
        audio.stop()
        tts.reset()
    }

    // MARK: - Audio control


    private func silenceAudio() {
        audio.onFinished  = nil
        audio.onWillSpeak = nil
        audio.stop()
        tts.reset()


        Task { @MainActor in
            try? await Task.sleep(for: .milliseconds(200))
            guard isActive else { return }
            audio.onWillSpeak = { range, total in
                Task { @MainActor in
                    guard self.isActive else { return }
                    tts.update(range: range, totalCharacters: total)
                }
            }
            audio.onFinished = {
                Task { @MainActor in
                    guard self.isActive else { return }
                    tts.finish()
                    handleAudioFinished()
                }
            }
        }
    }

    // MARK: - Private helpers

    private let indicatorHeight: CGFloat = 50

    private func pause() {
        isPaused = true
        audio.pause()
        tts.pause()
    }

    private func resume() {
        isPaused = false
        tts.resume()
        speakStep(at: index)
    }

    private func speakStep(at stepIndex: Int) {
        guard isActive else { return }
        tts.prepare(stepIndex: stepIndex)
        audio.speak(steps[stepIndex].audio)
    }

    private func handleAudioFinished() {
        guard isActive, !isPaused else { return }

        if didSwipeManually {
            didSwipeManually = false
            return
        }

        guard !steps[index].isInteractive else { return }
        guard index < steps.count - 1 else { return }

        let advancingFrom = index

        advanceTask?.cancel()
        advanceTask = Task { @MainActor in
            try? await Task.sleep(for: .milliseconds(600))
            guard !Task.isCancelled else { return }
            guard isActive else { return }
            guard !isPaused else { return }
            guard index == advancingFrom else { return }
            didSwipeManually = false
            index = index + 1
            speakStep(at: index)
        }
    }
}

// MARK: - Convenience init (no interactive content)

extension EmergencyFlowView where InteractiveContent == EmptyView {
    init(
        steps: [Step],
        navigationTitle: String,
        paginationAccentColor: Color = Color(red: 0.85, green: 0.15, blue: 0.15)
    ) {
        self.init(
            steps: steps,
            navigationTitle: navigationTitle,
            paginationAccentColor: paginationAccentColor
        ) { _, _ in EmptyView() }
    }
}

===== Sources/AppModule/Core/EmergencyFlow/EmergencyPageView.swift =====
import SwiftUI

// MARK: - EmergencyPageView

struct EmergencyPageView<Step: EmergencyStep, InteractiveContent: View>: View {

    let step: Step
    let stepNumber: Int
    let totalSteps: Int
    var isPageVisible: Bool = false

    @ViewBuilder private let interactiveContent: () -> InteractiveContent

    // MARK: Init â€” with interactive content

    init(
        step: Step,
        stepNumber: Int,
        totalSteps: Int,
        isPageVisible: Bool = false,
        @ViewBuilder interactiveContent: @escaping () -> InteractiveContent
    ) {
        self.step = step
        self.stepNumber = stepNumber
        self.totalSteps = totalSteps
        self.isPageVisible = isPageVisible
        self.interactiveContent = interactiveContent
    }

    // MARK: Body

    var body: some View {
        GeometryReader { geo in
            ScrollView(showsIndicators: false) {
                VStack(alignment: .leading, spacing: 0) {

                    ZStack {
                        RoundedRectangle(cornerRadius: 20, style: .continuous)
                            .fill(
                                LinearGradient(
                                    colors: [
                                        step.illustrationColor.opacity(0.70),
                                        Color(red: 0.10, green: 0.14, blue: 0.25)
                                    ],
                                    startPoint: .topLeading,
                                    endPoint: .bottomTrailing
                                )
                            )

                        if step.isInteractive {
                            interactiveContent()
                                .padding(.vertical, 16)
                        } else if let icon = step.illustrationIcon {
                            Image(systemName: icon)
                                .font(.system(size: 90, weight: .thin))
                                .foregroundStyle(.white)
                        }
                    }
                    .frame(
                        width: geo.size.width - 32,
                        height: step.isInteractive
                            ? geo.size.height * 0.62
                            : geo.size.height * 0.50
                    )
                    .padding(.horizontal, 16)
                    .padding(.top, 8)
                    .padding(.bottom, 24)

                    Text(step.title)
                        .font(.system(size: 28, weight: .bold))
                        .padding(.horizontal, 20)
                        .padding(.bottom, 10)

                    Text(markdownText(step.instruction))
                        .font(.system(size: 17))
                        .lineSpacing(3)
                        .padding(.horizontal, 20)
                        .padding(.bottom, 20)

                    if let guidance = step.sizeGuidance {
                        VStack(alignment: .leading, spacing: 12) {
                            HStack {
                                Image(systemName: "pawprint")
                                Text(guidance.smallDog)
                            }
                            HStack {
                                Image(systemName: "pawprint.fill")
                                Text(guidance.largeDog)
                            }
                        }
                        .font(.system(size: 16))
                        .padding(.horizontal, 20)
                        .padding(.bottom, 20)
                    }

                  
                    Spacer(minLength: 60)
                }
            }
        }
    }

    // MARK: - Markdown helper

    private func markdownText(_ string: String) -> AttributedString {
        (try? AttributedString(markdown: string)) ?? AttributedString(string)
    }
}

// MARK: - Convenience init â€” no interactive content

extension EmergencyPageView where InteractiveContent == EmptyView {
    init(
        step: Step,
        stepNumber: Int,
        totalSteps: Int,
        isPageVisible: Bool = false
    ) {
        self.init(
            step: step,
            stepNumber: stepNumber,
            totalSteps: totalSteps,
            isPageVisible: isPageVisible
        ) {
            EmptyView()
        }
    }
}

===== Sources/AppModule/Core/EmergencyFlow/EmergencyPaginationIndicator.swift =====


import SwiftUI

struct EmergencyPaginationIndicator: View {

    @ObservedObject var coordinator: TTSCoordinator
    let total: Int
    var accentColor: Color = Color(red: 0.85, green: 0.15, blue: 0.15)

    private var progress: Double {
        guard total > 1 else { return 1.0 }
        return Double(coordinator.currentIndex + 1) / Double(total)
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 6) {

            Text("Step \(coordinator.currentIndex + 1) of \(total)")
                .font(.system(size: 13, weight: .semibold))
                .foregroundStyle(.secondary)
                .contentTransition(.numericText())
                .animation(.easeInOut(duration: 0.25), value: coordinator.currentIndex)

            GeometryReader { geo in
                ZStack(alignment: .leading) {
                    Capsule()
                        .fill(accentColor.opacity(0.15))
                        .frame(height: 4)

                    Capsule()
                        .fill(accentColor)
                        .frame(width: geo.size.width * progress, height: 4)
                        .animation(.spring(response: 0.4, dampingFraction: 0.8), value: coordinator.currentIndex)
                }
            }
            .frame(height: 4)
        }
        .padding(.horizontal, 20)
        .padding(.vertical, 12)
        .accessibilityElement(children: .ignore)
        .accessibilityLabel("Step \(coordinator.currentIndex + 1) of \(total)")
        .accessibilityValue("\(Int(progress * 100)) percent complete")
    }
}

// MARK: - Audio Duration Helper

struct AudioDuration {

    static func estimate(for text: String, wordsPerMinute: Double = 140) -> String {
        formatted(seconds: rawSeconds(for: text, wordsPerMinute: wordsPerMinute))
    }

    static func rawSeconds(for text: String, wordsPerMinute: Double = 140) -> TimeInterval {
        let wc = Double(
            text.components(separatedBy: .whitespacesAndNewlines)
                .filter { !$0.isEmpty }.count
        )
        guard wc > 0, wordsPerMinute > 0 else { return 0 }
        return (wc / wordsPerMinute) * 60
    }

    static func totalEstimate(for steps: [String], wordsPerMinute: Double = 140) -> String {
        formatted(seconds: steps.reduce(0) { $0 + rawSeconds(for: $1, wordsPerMinute: wordsPerMinute) })
    }

    private static func formatted(seconds: TimeInterval) -> String {
        let t = Int(seconds.rounded())
        guard t > 0 else { return "< 1 sec" }
        let m = t / 60; let s = t % 60
        switch (m, s) {
        case (0, let s): return "~\(s) sec"
        case (let m, 0): return "~\(m) min"
        default:         return "~\(m) min \(s) sec"
        }
    }
}

===== Sources/AppModule/Core/EmergencyFlow/EmergencyStep.swift =====


import SwiftUI

// MARK: - EmergencyStep


public protocol EmergencyStep: Identifiable {

    var title: String { get }
    var instruction: String { get }
    var audio: String { get }
    var illustrationColor: Color { get }
    var illustrationIcon: String? { get }
    var isInteractive: Bool { get }
    var sizeGuidance: SizeGuidance? { get }
}

// MARK: - Default implementations

public extension EmergencyStep {
    var illustrationIcon: String? { nil }
    var isInteractive: Bool { false }
    var sizeGuidance: SizeGuidance? { nil }
}

// MARK: - SizeGuidance  (shared, moved out of CPRStep.swift)

public struct SizeGuidance {
    public let smallDog: String
    public let largeDog: String

    public init(smallDog: String, largeDog: String) {
        self.smallDog = smallDog
        self.largeDog = largeDog
    }
}

===== Sources/AppModule/Core/Haptics/HapticManager.swift =====
import UIKit
import AVFoundation

enum Haptic {

    @MainActor
    static func tap() {
        if UIDevice.current.userInterfaceIdiom == .pad {
            AudioServicesPlaySystemSound(1104)
        } else {
            let generator = UISelectionFeedbackGenerator()
            generator.selectionChanged()
        }
    }

    @MainActor
    static func success() {
        if UIDevice.current.userInterfaceIdiom == .pad {
            AudioServicesPlaySystemSound(1407) 
        } else {
            let generator = UINotificationFeedbackGenerator()
            generator.notificationOccurred(.success)
        }
    }
}

===== Sources/AppModule/Features/Checklist/ChecklistNotificationManager.swift =====

import Foundation
@preconcurrency import UserNotifications

@MainActor
final class ChecklistNotificationManager: ObservableObject {

    static let shared = ChecklistNotificationManager()

    // MARK: Published


    @Published private(set) var isAuthorized = false


    @Published private(set) var hasRequestedPermission = false

    // MARK: Keys

    private let permissionAskedKey    = "checklist_notif_permission_asked"
    private let lastScheduledKey      = "checklist_notif_last_scheduled"
    private let notifCategoryID       = "CHECKLIST_REMINDER"
    private let notifIdentifierPrefix = "checklist_missing_"


    private let reminderIntervalDays: Int = 7

    private init() {
        hasRequestedPermission = UserDefaults.standard.bool(forKey: permissionAskedKey)
        Task { await refreshAuthorizationStatus() }
    }

    // MARK: - Permission


    func refreshAuthorizationStatus() async {
        let settings = await UNUserNotificationCenter.current().notificationSettings()
        isAuthorized = settings.authorizationStatus == .authorized
    }

    func requestPermission() async {
        UserDefaults.standard.set(true, forKey: permissionAskedKey)
        hasRequestedPermission = true
        do {
            let granted = try await UNUserNotificationCenter.current()
                .requestAuthorization(options: [.alert, .sound, .badge])
            isAuthorized = granted
        } catch {
            isAuthorized = false
        }
    }

    // MARK: - Scheduling

    func scheduleRemindersIfNeeded(missingItems: [String], totalCount: Int) {
        guard isAuthorized else { return }
        guard !missingItems.isEmpty else {

            cancelAllReminders()
            return
        }


        if let last = UserDefaults.standard.object(forKey: lastScheduledKey) as? Date {
            let daysSince = Calendar.current.dateComponents([.day], from: last, to: Date()).day ?? 0
            if daysSince < reminderIntervalDays { return }
        }

        cancelAllReminders()
        scheduleReminders(for: missingItems)
        UserDefaults.standard.set(Date(), forKey: lastScheduledKey)
    }


    func cancelAllReminders() {
        let center = UNUserNotificationCenter.current()
        center.getPendingNotificationRequests { requests in
            let ids = requests
                .map(\.identifier)
                .filter { $0.hasPrefix(self.notifIdentifierPrefix) }
            center.removePendingNotificationRequests(withIdentifiers: ids)
        }
    }

    // MARK: - Private scheduling logic

    private func scheduleReminders(for missingItems: [String]) {
        let center   = UNUserNotificationCenter.current()
        let shuffled = missingItems.shuffled()
        let schedules: [(daysFromNow: Int, item: String)] = [
            (7,  shuffled[0]),
            (14, shuffled.count > 1 ? shuffled[1] : shuffled[0]),
            (21, shuffled.count > 2 ? shuffled[2] : shuffled[0]),
        ]

        for (idx, schedule) in schedules.enumerated() {
            let content        = UNMutableNotificationContent()
            content.sound      = .default
            content.categoryIdentifier = notifCategoryID

            let remaining = missingItems.count

            if remaining == 1 {
                content.title = "One item missing from your kit ðŸ©¹"
                content.body  = "You're almost ready! Add \"\(schedule.item)\" to complete your dog's first aid kit."
            } else {
                content.title = "\(remaining) items missing from your kit ðŸ©¹"
                content.body  = "Don't forget: \"\(schedule.item)\" â€” and \(remaining - 1) other item\(remaining - 1 == 1 ? "" : "s") â€” could save your dog's life."
            }

            
            var triggerDate        = Calendar.current.date(
                byAdding: .day, value: schedule.daysFromNow, to: Date()
            ) ?? Date()
            triggerDate            = Calendar.current.date(
                bySettingHour: 10, minute: 0, second: 0, of: triggerDate
            ) ?? triggerDate

            let components = Calendar.current.dateComponents([.year, .month, .day, .hour, .minute], from: triggerDate)
            let trigger    = UNCalendarNotificationTrigger(dateMatching: components, repeats: false)
            let request    = UNNotificationRequest(
                identifier: "\(notifIdentifierPrefix)\(idx)",
                content   : content,
                trigger   : trigger
            )

            center.add(request)
        }
    }
}

===== Sources/AppModule/Features/Checklist/ChecklistView.swift =====
import SwiftUI

struct ChecklistItem: Identifiable, Hashable {
    let id          : String
    let description : String
    let usage       : String
}

struct IdentifiableString: Identifiable, Hashable {
    let id: String
}

struct ChecklistView: View {

    // MARK: Persistence

    @AppStorage("checkedChecklistItems")
    private var storedItemsData: Data = Data()

    // MARK: State

    @State private var checkedItems     : Set<String>         = []
    @State private var showConfetti     : Bool                = false
    @State private var selectedInfoItem : IdentifiableString? = nil

    @StateObject private var notifManager = ChecklistNotificationManager.shared

    // MARK: Data

    private let items: [ChecklistItem] = [
        ChecklistItem(
            id: "Gauze Pads (4x4) & rolls",
            description: "Sterile absorbent pads and gauze rolls to apply direct pressure and absorb blood.",
            usage: "BLEEDING: Press firmly on wound for 10+ minutes. Stack multiple pads. Secure with vet wrap."
        ),
        ChecklistItem(
            id: "Vet wrap & adhesive tape",
            description: "Self-adhering flexible bandage that sticks to itself, not fur. Stretches for secure fit.",
            usage: "BANDAGING: Wrap over gauze snugly (2 layers). Check toes stay pink/warm every 10 min."
        ),
        ChecklistItem(
            id: "Digital thermometer",
            description: "Rectal probe with flexible tip. Normal range: 101-102.5Â°F (38.3-39.2Â°C).",
            usage: "FEVER/SHOCK: Lubricate tip, insert 1 inch rectally. >103Â°F or <100Â°F = emergency."
        ),
        ChecklistItem(
            id: "Blunt scissors",
            description: "Safety rounded tips prevent cutting skin. Bandage/fur cutting only.",
            usage: "WOUNDS: Trim fur around injury for cleaning. Cut bandages without snagging skin."
        ),
        ChecklistItem(
            id: "Tweezers / forceps",
            description: "Pointed precision grip for small objects. Hemostat-style best.",
            usage: "SPLINTERS/TICKS: Grasp at skin level, steady pull. Never squeeze tick body."
        ),
        ChecklistItem(
            id: "Needleless syringes",
            description: "3ml+ plastic syringes without needle. Oral dosing or wound irrigation.",
            usage: "WOUND FLUSH: Fill with saline, flush debris. MEDS: Slow oral squirting side of mouth."
        ),
        ChecklistItem(
            id: "Saline solution (eye flush)",
            description: "Sterile 0.9% sodium chloride. Safe for eyes, wounds, mouth.",
            usage: "EYE/CHEMICAL: Flush continuously 10+ minutes. WOUNDS: Irrigate before bandaging."
        ),
        ChecklistItem(
            id: "Hydrogen peroxide (3%)",
            description: "Induces vomiting ONLY when vet instructs. Never for wounds/rinsing.",
            usage: "TOXINS: 1 tsp per 5 lbs body weight. ONLY if vet approves. Causes ulcers if misused."
        ),
        ChecklistItem(
            id: "Styptic powder (nail bleeds)",
            description: "Clotting agent for quick nail bleeding stop. Kwik-Stik brand ideal.",
            usage: "BROKEN NAILS: Dip bleeding tip into powder. Apply 30 seconds pressure."
        ),
        ChecklistItem(
            id: "Antiseptic wipes (no alcohol)",
            description: "Chlorhexidine or povidone-iodine impregnated. Kills bacteria without stinging.",
            usage: "MINOR CUTS: Clean around wound edges before bandaging. Avoid deep punctures."
        ),
        ChecklistItem(
            id: "Penlight / flashlight",
            description: "Focused beam for mouth, eyes, wounds. 100+ lumens minimum.",
            usage: "ASSESSMENT: Check gum color (pink normal), pupil response, wound depth."
        ),
        ChecklistItem(
            id: "Muzzles",
            description: "Quick-release fabric or basket style. Sizes for all breeds.",
            usage: "PAIN EMERGENCIES: Apply BEFORE treating injuries. Even sweet dogs bite when hurt."
        ),
    ]

    private var progress: Double {
        Double(checkedItems.count) / Double(items.count)
    }

    private var missingItems: [String] {
        items.filter { !checkedItems.contains($0.id) }.map(\.id)
    }

    // MARK: Body

    var body: some View {
        ZStack {
            List {

                Section {
                    VStack(alignment: .leading, spacing: 12) {
                        Text("First Aid Kit Checklist")
                            .font(.title2.bold())

                        Text("Essential items for dog emergencies.")
                            .font(.subheadline)
                            .foregroundColor(.secondary)

                        ProgressView(value: progress)
                            .tint(.green)

                        Text("\(checkedItems.count) of \(items.count) items ready")
                            .font(.caption)
                            .foregroundColor(.secondary)
                    }
                    .padding(.vertical, 8)
                }


                Section {
                    ForEach(items) { item in
                        Button {
                            toggle(item.id)
                        } label: {
                            HStack(spacing: 16) {
                                Image(systemName: checkedItems.contains(item.id)
                                      ? "checkmark.circle.fill" : "circle")
                                    .foregroundColor(checkedItems.contains(item.id) ? .green : .secondary)
                                    .font(.title3)

                                Text(item.id)
                                    .foregroundColor(.primary)

                                Spacer()

                                Button {
                                    selectedInfoItem = IdentifiableString(id: item.id)
                                } label: {
                                    Image(systemName: "info.circle")
                                        .font(.callout)
                                        .foregroundColor(.secondary)
                                        .padding(8)
                                }
                                .buttonStyle(.borderless)
                            }
                            .contentShape(Rectangle())
                            .padding(.vertical, 6)
                        }
                    }
                }
            }
            .listStyle(.insetGrouped)
            .navigationTitle("Checklist")

            if showConfetti {
                ConfettiView()
                    .ignoresSafeArea()
                    .allowsHitTesting(false)
                    .onAppear {
                        DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
                            withAnimation { showConfetti = false }
                        }
                    }
            }
        }
        .sheet(item: $selectedInfoItem) { selected in
            if let item = items.first(where: { $0.id == selected.id }) {
                NavigationStack {
                    ScrollView {
                        VStack(alignment: .leading, spacing: 20) {
                            Text(item.id)
                                .font(.title2.bold())
                                .padding(.bottom, 4)

                            VStack(alignment: .leading, spacing: 8) {
                                Text("Description").font(.headline)
                                Text(item.description).font(.body)
                            }

                            VStack(alignment: .leading, spacing: 12) {
                                Text("When to use").font(.headline)
                                VStack(alignment: .leading, spacing: 8) {
                                    ForEach(item.usage.components(separatedBy: ". "), id: \.self) { line in
                                        if !line.isEmpty {
                                            HStack(alignment: .top, spacing: 8) {
                                                Image(systemName: "checkmark.circle.fill")
                                                    .font(.caption)
                                                    .foregroundColor(.green)
                                                    .padding(.top, 2)
                                                Text(line)
                                                    .font(.body)
                                                    .fixedSize(horizontal: false, vertical: true)
                                            }
                                        }
                                    }
                                }
                            }
                            Spacer()
                        }
                        .padding()
                    }
                    .navigationBarTitleDisplayMode(.inline)
                    .toolbar {
                        ToolbarItem(placement: .navigationBarTrailing) {
                            Button {
                                selectedInfoItem = nil
                            } label: {
                                Image(systemName: "xmark.circle.fill")
                                    .font(.title3)
                                    .foregroundColor(.secondary)
                            }
                        }
                    }
                    .presentationDetents([.medium, .large])
                }
            }
        }
        .onAppear {
            loadChecklistState()
            Task {
                await notifManager.refreshAuthorizationStatus()

                guard !notifManager.hasRequestedPermission else { return }
                try? await Task.sleep(for: .milliseconds(600))
                await notifManager.requestPermission()
                notifManager.scheduleRemindersIfNeeded(
                    missingItems: missingItems,
                    totalCount  : items.count
                )
            }
        }
    }

    // MARK: - Helpers

    private func toggle(_ itemID: String) {
        let wasCompleted = checkedItems.count == items.count
        Haptic.tap()

        if checkedItems.contains(itemID) {
            checkedItems.remove(itemID)
        } else {
            checkedItems.insert(itemID)
        }

        saveChecklistState()

        if notifManager.isAuthorized {
            notifManager.scheduleRemindersIfNeeded(
                missingItems: missingItems,
                totalCount  : items.count
            )
        }

        let isNowCompleted = checkedItems.count == items.count
        if !wasCompleted && isNowCompleted {
            Haptic.success()
            withAnimation { showConfetti = true }
        }
    }

    private func saveChecklistState() {
        storedItemsData = (try? JSONEncoder().encode(Array(checkedItems))) ?? Data()
    }

    private func loadChecklistState() {
        if let decoded = try? JSONDecoder().decode([String].self, from: storedItemsData) {
            checkedItems = Set(decoded)
        }
    }
}

// MARK: - Preview

struct ChecklistView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            ChecklistView()
        }
    }
}

===== Sources/AppModule/Features/Disclaimer/DisclaimerView.swift =====
import SwiftUI

struct DisclaimerView: View {
    let onContinue: () -> Void

    @ScaledMetric private var rowSpacing: CGFloat = 24
    @ScaledMetric private var iconSize: CGFloat = 28
    @ScaledMetric private var iconWidth: CGFloat = 34
    @ScaledMetric private var rowInnerSpacing: CGFloat = 14

    private struct DisclaimerPoint: Identifiable {
        let id = UUID()
        let icon: String
        let title: String
        let body: String
    }

    private let points: [DisclaimerPoint] = [
        DisclaimerPoint(icon: "pawprint.fill", title: "For Dogs Only",
                        body: "All guidance in this app is written specifically for dogs and their emergencies."),
        DisclaimerPoint(icon: "staroflife.fill", title: "First Aid Guidance Only",
                        body: "This app provides emergency first aid steps â€” not diagnosis or medical treatment."),
        DisclaimerPoint(icon: "cross.case.fill", title: "Not a Substitute for a Vet",
                        body: "Always contact a licensed veterinarian as soon as possible in any emergency."),
        DisclaimerPoint(icon: "iphone.slash", title: "Works Offline",
                        body: "All content is available without an internet connection, always ready when you need it.")
    ]

    var body: some View {
        VStack(alignment: .leading, spacing: 0) {
            Text("Welcome to DogsAID")
                .font(.title2.bold())
                .padding(.top, 32)
                .padding(.horizontal, 24)
                .padding(.bottom, rowSpacing)

            VStack(alignment: .leading, spacing: rowSpacing) {
                ForEach(points) { point in
                    HStack(alignment: .top, spacing: rowInnerSpacing) {
                        Image(systemName: point.icon)
                            .font(.system(size: iconSize))
                            .foregroundStyle(.blue)
                            .frame(width: iconWidth)

                        VStack(alignment: .leading, spacing: 4) {
                            Text(point.title)
                                .font(.headline)

                            Text(point.body)
                                .font(.subheadline)
                                .foregroundStyle(.secondary)
                        }
                    }
                }
            }
            .padding(.horizontal, 24)

            Spacer(minLength: 32)

            Button {
                onContinue()
            } label: {
                Text("Continue")
                    .font(.headline)
                    .foregroundStyle(.white)
                    .frame(maxWidth: .infinity)
                    .padding(.vertical, 16)
                    .background(.blue)
                    .clipShape(Capsule())
            }
            .padding(.horizontal, 24)
            .padding(.bottom, 40)
        }
    }
}

===== Sources/AppModule/Features/Emergency/Care & Whelping/PregnancyWhelpingEmergencyView.swift =====
import SwiftUI

struct PregnancyWhelpingEmergencyView: View {
    private let steps: [InfoStep] = [
        InfoStep(
            title: "IDENTIFY TROUBLE",
            instruction: "Seek help if there is more than 2 hours between puppies or 30 minutes of strong straining with no puppy.",
            audio: "Call the vet if there is more than two hours between puppies or thirty minutes of hard straining.",
            illustrationIcon: "clock.fill",
            illustrationColor: Color(red: 0.55, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "GREEN DISCHARGE",
            instruction: "Dark green discharge BEFORE the first puppy is born indicates an emergency (placental separation).",
            audio: "Dark green discharge before any puppies are born is an emergency.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.95, green: 0.55, blue: 0.15)
        ),
        InfoStep(
            title: "CHECK FOR OBSTRUCTION",
            instruction: "If a puppy is partially visible but stuck for more than 5 minutes, DO NOT pull forcefully.",
            audio: "Do not pull a stuck puppy. Contact a veterinarian immediately.",
            illustrationIcon: "waveform.path.ecg",
            illustrationColor: Color(red: 0.85, green: 0.35, blue: 0.45)
        ),
        InfoStep(
            title: "EXCESSIVE BLEEDING",
            instruction: "Some blood is normal, but heavy, continuous bleeding is a life-threatening emergency for the mother.",
            audio: "Heavy, continuous bleeding is a life-threatening emergency.",
            illustrationIcon: "eye.fill",
            illustrationColor: Color(red: 0.40, green: 0.55, blue: 0.95)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "If any abnormal signs occur, transport the mother to the vet immediately. Delayed care can be fatal.",
            audio: "Go to an emergency vet immediately if complications occur.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Pregnancy & Whelping",
            paginationAccentColor: Color(red: 0.55, green: 0.55, blue: 0.85)
        )
    }
}

struct PregnancyWhelpingView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            PregnancyWhelpingEmergencyView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Care & Whelping/VomitingView.swift =====


import SwiftUI

struct VomitingView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "WITHHOLD FOOD",
            instruction: "Remove food for 12â€“24 hours to let the stomach rest. Provide small amounts of water or ice cubes to prevent dehydration.",
            audio: "Do not feed the dog for twelve hours, but offer small sips of water.",
            illustrationIcon: "eye.fill",
            illustrationColor: Color(red: 0.20, green: 0.50, blue: 0.80)
        ),
        InfoStep(
            title: "BLOAT CHECK",
            instruction: "If vomiting is accompanied by a hard, swollen belly or unproductive retching, go to the vet immediately.",
            audio: "If the dog has a swollen belly or can't vomit, see a vet now.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "IDENTIFY TOXINS",
            instruction: "Check if the dog could have ingested toxic foods, plants, or household chemicals. Note the color and consistency of the vomit.",
            audio: "Check for ingested toxins and note the appearance of the vomit.",
            illustrationIcon: "fork.knife",
            illustrationColor: Color(red: 0.55, green: 0.38, blue: 0.22)
        ),
        InfoStep(
            title: "CHECK FOR SHOCK",
            instruction: "Look for pale gums, extreme lethargy, or a rapid heartbeat. These are signs of a severe internal issue.",
            audio: "Watch for pale gums or extreme weakness.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.18, green: 0.52, blue: 0.92)
        ),
        InfoStep(
            title: "REINTRODUCE FOOD",
            instruction: "After 12 hours without vomiting, offer a bland diet of boiled chicken and rice in small portions.",
            audio: "Offer small portions of boiled chicken and rice after twelve hours.",
            illustrationIcon: "takeoutbag.and.cup.and.straw.fill",
            illustrationColor: Color(red: 0.22, green: 0.62, blue: 0.22)
        ),
        InfoStep(
            title: "CALL THE VET",
            instruction: "If vomiting persists for more than 24 hours, or if the dog is very young or old, seek professional advice.",
            audio: "Call the vet if vomiting continues or if your dog is very young or old.",
            illustrationIcon: "phone.fill",
            illustrationColor: Color(red: 0.55, green: 0.18, blue: 0.78)
        ),
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Vomiting",
            paginationAccentColor: Color(red: 0.20, green: 0.50, blue: 0.80)
        )
    }
}

struct VomitingView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            VomitingView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Critical Symptoms/BlueGums.swift =====

import SwiftUI

struct BlueGumsView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "OXYGEN EMERGENCY",
            instruction: "Blue or purple gums mean the dog is not getting enough oxygen. This is a critical emergency.",
            audio: "Blue or purple gums mean your dog is suffocating. This is a critical emergency.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "KEEP CALM",
            instruction: "Stay calm and speak softly. Panic increases the dog's oxygen demand and worsens the crisis.",
            audio: "Keep your dog calm and still. Stay calm yourself.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "FRESH AIR",
            instruction: "Immediately move the dog to an area with fresh air. Open windows if you are indoors or in a car.",
            audio: "Get fresh air immediately. Open all windows.",
            illustrationIcon: "wind",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "LOOSEN COLLAR",
            instruction: "Gently loosen any tight collars, harnesses, or clothing that might restrict breathing.",
            audio: "Loosen any tight collar or harness gently.",
            illustrationIcon: "figure.walk.circle.fill",
            illustrationColor: Color(red: 0.70, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "MONITOR BREATHING",
            instruction: "Watch for gasping or heavy use of the abdominal muscles to breathe.",
            audio: "Monitor breathing effort very closely.",
            illustrationIcon: "lungs.fill",
            illustrationColor: Color(red: 0.30, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "TRANSPORT IMMEDIATELY",
            instruction: "Do not delay. Keep the dog calm and drive to the nearest vet for oxygen therapy.",
            audio: "Drive to the vet immediately for oxygen. Keep the dog as calm as possible.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Blue Gums (Oxygen Crisis)",
            paginationAccentColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    }
}

struct BlueGumsView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            BlueGumsView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Critical Symptoms/BreathingDifficulty.swift =====
import SwiftUI

struct BreathingDifficultyView: View {
    private let steps: [InfoStep] = [
        InfoStep(
            title: "REDUCE STRESS",
            instruction: "Keep the dog still and calm. Do not force the dog into any specific position.",
            audio: "Keep your dog very calm. Do not force them to move or change positions.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.90, green: 0.60, blue: 0.10)
        ),
        InfoStep(
            title: "OBSERVE BREATHING",
            instruction: "Watch for labored breathing, gasping, or using the belly to breathe. These are signs of a major emergency.",
            audio: "Watch for gasping or heavy breathing effort.",
            illustrationIcon: "eye.fill",
            illustrationColor: Color(red: 0.40, green: 0.55, blue: 0.95)
        ),
        InfoStep(
            title: "CHECK GUM COLOR",
            instruction: "Check if the gums are blue or purple, which indicates a severe lack of oxygen.",
            audio: "Check if the gums are blue or purple.",
            illustrationIcon: "mouth.fill",
            illustrationColor: Color(red: 0.80, green: 0.30, blue: 0.20)
        ),
        InfoStep(
            title: "ALLOW COUGHING",
            instruction: "If the dog is coughing but still breathing, allow them to continue. Do not reach into the throat.",
            audio: "If the dog can breathe, let them cough.",
            illustrationIcon: "lungs.fill",
            illustrationColor: Color(red: 0.55, green: 0.75, blue: 0.95)
        ),
        InfoStep(
            title: "SEEK VET CARE",
            instruction: "Labored breathing requires immediate veterinary intervention. Transport the dog to the vet now.",
            audio: "If your dog is struggling to breathe, go to the vet immediately.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Breathing Difficulty",
            paginationAccentColor: Color(red: 0.55, green: 0.75, blue: 0.95)
        )
    }
}

===== Sources/AppModule/Features/Emergency/Critical Symptoms/FrostbiteHypothermiaView.swift =====
import SwiftUI

struct FrostbiteHypothermiaView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "RECOGNIZE SYMPTOMS",
            instruction: "Look for shivering, lethargy, or cold, pale skin. Severe cases may lead to collapse.",
            audio: "Watch for shivering, weakness, or cold skin.",
            illustrationIcon: "snowflake",
            illustrationColor: Color(red: 0.35, green: 0.55, blue: 0.90)
        ),
        InfoStep(
            title: "MOVE TO WARMTH",
            instruction: "Immediately move the dog to a warm, dry environment. Protect them from wind and moisture.",
            audio: "Move your dog to a warm, dry area immediately.",
            illustrationIcon: "house.fill",
            illustrationColor: Color(red: 0.45, green: 0.65, blue: 0.55)
        ),
        InfoStep(
            title: "GENTLE WARMING",
            instruction: "Wrap the dog in warm, dry blankets. Use your own body heat if possible.",
            audio: "Move the dog inside. Wrap them in warm, dry blankets.",
            illustrationIcon: "pause.circle.fill",
            illustrationColor: Color(red: 0.65, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "DO NOT RUB",
            instruction: "Do not rub or massage affected areas, as this damages the frozen tissue.",
            audio: "Do not rub or massage the skin. This can cause severe tissue damage.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.75, green: 0.35, blue: 0.35)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "Moderate to severe hypothermia requires professional treatment to prevent organ failure.",
            audio: "Seek veterinary care immediately.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Frostbite & Hypothermia",
            paginationAccentColor: Color(red: 0.35, green: 0.55, blue: 0.90)
        )
    }
}

struct FrostbiteHypothermiaView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            FrostbiteHypothermiaView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Critical Symptoms/Heatstroke.swift =====

import SwiftUI

struct HeatstrokeView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "MOVE TO SHADE",
            instruction: "Immediately move the dog to a cool, shaded area. Use a fan if possible.",
            audio: "Move your dog to a cool, shaded area immediately.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.98, green: 0.45, blue: 0.10)
        ),
        InfoStep(
            title: "COOL GENTLY",
            instruction: "Soak the coat with lukewarm water. DO NOT use ice or freezing water as it causes dangerous shock.",
            audio: "Wet the fur with lukewarm water. Do not use ice or freezing water.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "TARGET TEMPERATURE",
            instruction: "Aim to cool the dog until their temperature reaches 103Â°F. Stop active cooling once this target is reached.",
            audio: "Cool the dog until their temperature is 103 degrees, then stop.",
            illustrationIcon: "thermometer.high",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "SMALL SIPS ONLY",
            instruction: "Offer small sips of water or ice chips ONLY if the dog is alert. Do not force them to drink.",
            audio: "Give small sips of water only if the dog is conscious.",
            illustrationIcon: "cup.and.saucer.fill",
            illustrationColor: Color(red: 0.70, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "VET CARE MANDATORY",
            instruction: "Even if the dog seems better, internal organ damage is likely. Professional vet care is mandatory.",
            audio: "You must see a vet immediately. Internal damage can be fatal even if the dog looks better.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.98, green: 0.25, blue: 0.10)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Heatstroke",
            paginationAccentColor: Color(red: 0.98, green: 0.45, blue: 0.10)
        )
    }
}

struct HeatstrokeView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            HeatstrokeView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Critical Symptoms/SeizuresView.swift =====



import SwiftUI

struct SeizuresView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "DO NOT RESTRAIN",
            instruction: "Move furniture away to prevent injury. DO NOT put your hands in or near the dog's mouth.",
            audio: "Do not restrain the dog. Move objects away to prevent injury. Keep your hands away from the mouth.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.85, green: 0.20, blue: 0.35)
        ),
        InfoStep(
            title: "POSITION SAFELY",
            instruction: "Gently roll the dog onto their side if safe. Support the head with a soft towel.",
            audio: "Gently roll the dog onto their side and support their head.",
            illustrationIcon: "pause.circle.fill",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "TIME THE SEIZURE",
            instruction: "Note the exact start and end time. Keep the room dark and quiet to reduce stimulation.",
            audio: "Note the duration of the seizure. Keep the environment dark and quiet.",
            illustrationIcon: "stopwatch.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "MONITOR RECOVERY",
            instruction: "Expect confusion or temporary blindness after the seizure. Keep the dog calm and quiet during recovery.",
            audio: "Post-seizure confusion is normal. Keep the dog calm and quiet.",
            illustrationIcon: "bed.double.fill",
            illustrationColor: Color(red: 0.70, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "VET CONSULTATION",
            instruction: "If the seizure lasts more than 3 minutes, or if multiple seizures occur, go to the vet immediately.",
            audio: "If the seizure lasts longer than three minutes, or if they happen in clusters, go to the vet now.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Seizures",
            paginationAccentColor: Color(red: 0.85, green: 0.20, blue: 0.35)
        )
    }
}

struct SeizuresView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            SeizuresView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Critical Symptoms/UrinaryBlockageView.swift =====
import SwiftUI

struct UrinaryBlockageView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "IDENTIFY STRAINING",
            instruction: "Look for frequent, unsuccessful attempts to urinate. This is most common in male dogs.",
            audio: "Look for straining to urinate with no results. This is an emergency.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.80, green: 0.25, blue: 0.30)
        ),
        InfoStep(
            title: "FATAL WARNING",
            instruction: "A complete blockage is fatal within 24â€“48 hours. Go to the emergency vet immediately.",
            audio: "A urinary blockage is fatal within forty-eight hours. Go to the emergency vet right now.",
            illustrationIcon: "stopwatch.fill",
            illustrationColor: Color(red: 0.95, green: 0.45, blue: 0.15)
        ),
        InfoStep(
            title: "KEEP DOG CALM",
            instruction: "Restrict the dog's movement. DO NOT massage the bladder or apply pressure to the abdomen.",
            audio: "Keep your dog calm and still. Do not press on the belly.",
            illustrationIcon: "pause.circle.fill",
            illustrationColor: Color(red: 0.55, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "DO NOT TREAT AT HOME",
            instruction: "DO NOT attempt to give medications or home remedies. This is a mechanical blockage that requires professional tools.",
            audio: "Do not attempt home treatment. This requires a veterinarian.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.75, green: 0.35, blue: 0.35)
        ),
        InfoStep(
            title: "IMMEDIATE VET CARE",
            instruction: "Emergency catheterization and IV fluids are required immediately to save the dog's life.",
            audio: "Go to an emergency vet immediately.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Urinary Blockage",
            paginationAccentColor: Color(red: 0.80, green: 0.25, blue: 0.30)
        )
    }
}

struct UrinaryBlockageView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            UrinaryBlockageView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/EmergencyHome/EmergencyHomeView.swift =====
import SwiftUI

// MARK: - EmergencyHomeView

struct EmergencyHomeView: View {

    @State private var searchText = ""
    @State private var intentRoute: EmergencyRoute?

    @Environment(\.horizontalSizeClass) private var horizontalSizeClass

    // MARK: Derived State

    private var searchResults: [EmergencyTopicModel] {
        guard !searchText.isEmpty else { return [] }
        return EmergencyTopicCatalog.allTopics.filter {
            $0.title.localizedCaseInsensitiveContains(searchText)
        }
    }

    // MARK: Body

    var body: some View {
        List {
            heroImageSection
            contentSection
        }
        .listStyle(.insetGrouped)
        .navigationTitle("Emergencies")
        .navigationBarTitleDisplayMode(horizontalSizeClass == .regular ? .inline : .large)
        .searchable(text: $searchText, prompt: "Search emergenciesâ€¦")
        .scrollDismissesKeyboard(.interactively)
        .onChange(of: searchText) { oldValue, newValue in
            handleSearchChange(newValue)
        }

        .navigationDestination(for: EmergencyRoute.self) { route in
            EmergencyRouter.destination(for: route)
        }
        
        .navigationDestination(isPresented: Binding(
            get: { intentRoute != nil },
            set: { if !$0 { intentRoute = nil } }
        )) {
            if let route = intentRoute {
                EmergencyRouter.destination(for: route)
            }
        }
    }

    // MARK: - Sections

    @ViewBuilder
    private var heroImageSection: some View {
        if searchText.isEmpty {
            Section {
                Image("HomeScreenDog")
                    .resizable()
                    .scaledToFit()
                    .frame(maxWidth: .infinity)
                    .frame(height: 220)
                    .listRowBackground(Color.clear)
                    .listRowSeparator(.hidden)
                    .listRowInsets(EdgeInsets())
            }
        }
    }

    @ViewBuilder
    private var contentSection: some View {
        if searchText.isEmpty {
            catalogSections
        } else if searchResults.isEmpty {
            emptySearchSection
        } else {
            Section {
                ForEach(searchResults) { TopicListRow(topic: $0) }
            }
        }
    }

    @ViewBuilder
    private var catalogSections: some View {
        ForEach(EmergencyTopicCatalog.sections) { section in
            Section(header: sectionHeader(section.title)) {
                ForEach(section.topics) { TopicListRow(topic: $0) }
            }
        }
    }

    private var emptySearchSection: some View {
        Section {
            VStack(spacing: 12) {
                Image(systemName: "magnifyingglass")
                    .font(.system(size: 40, weight: .light))
                    .foregroundStyle(.tertiary)

                Text("No Results")
                    .font(.system(size: 20, weight: .semibold))

                Text("No results for \"\(searchText)\".\nTry a different search term.")
                    .font(.system(size: 14))
                    .foregroundStyle(.secondary)
                    .multilineTextAlignment(.center)
            }
            .frame(maxWidth: .infinity)
            .padding(.vertical, 40)
            .listRowBackground(Color.clear)
            .listRowSeparator(.hidden)
        }
    }

    // MARK: - Intent Handling

    private func handleSearchChange(_ newValue: String) {
        guard let intent = EmergencyIntentResolver.resolve(from: newValue) else { return }
        intentRoute = EmergencyIntentResolver.route(for: intent)
    }

    // MARK: - Helpers

    private func sectionHeader(_ title: String) -> some View {
        Text(title)
            .font(.system(size: 22, weight: .bold))
            .foregroundStyle(.primary)
            .textCase(nil)
            .padding(.top, 8)
    }
}

// MARK: - TopicListRow


struct TopicListRow: View {
    let topic: EmergencyTopicModel

    var body: some View {
        NavigationLink(value: topic.route) {
            HStack(spacing: 14) {
                topicIcon
                Text(topic.title)
                    .font(.system(size: 17))
                    .foregroundStyle(.primary)
            }
            .padding(.vertical, 2)
        }
    }

    private var topicIcon: some View {
        ZStack {
            RoundedRectangle(cornerRadius: 8, style: .continuous)
                .fill(topic.iconColor)
                .frame(width: 32, height: 32)
            Image(systemName: topic.icon)
                .font(.system(size: 15, weight: .semibold))
                .foregroundStyle(.white)
        }
    }
}

// MARK: - Preview

#Preview {
    NavigationStack {
        EmergencyHomeView()
    }
}

===== Sources/AppModule/Features/Emergency/EmergencyHome/EmergencyRouter.swift =====
import SwiftUI

enum EmergencyRouter {

    @MainActor @ViewBuilder
    static func destination(for route: EmergencyRoute) -> some View {
        switch route {
        case .dogCPR:                DogCPREmergencyView()
        case .choking:               ChokingEmergencyView()
        case .drowning:              DrowningEmergencyView()
        case .bloat:                 BloatView()
        case .anaphylaxis:           AnaphylaxisView()

        case .bleedingControl:       BleedingControlView()
        case .fractures:             FracturesView()
        case .hitByCar:              HitByCarView()
        case .temperatureBurns:      TemperatureBurnsView()
        case .electricShock:         ElectricShockView()
        case .eyeInjuries:           EyeInjuriesView()

        case .poisonExposure:        PoisonExposureView()
        case .plantPoisoning:        PlantPoisoningView()
        case .foodPoisoning:         FoodPoisoningView()
        case .snakeBitesStings:      SnakeBitesStingsView()

        case .seizures:              SeizuresView()
        case .heatstroke:            HeatstrokeView()
        case .frostbiteHypothermia:  FrostbiteHypothermiaView()
        case .blueGums:              BlueGumsView()
        case .breathingDifficulty:   BreathingDifficultyView()
        case .urinaryBlockage:       UrinaryBlockageView()

        case .pregnancyWhelping:     PregnancyWhelpingEmergencyView()
        case .vomiting:              VomitingView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/EmergencyHome/EmergencytopicModel.swift =====
import SwiftUI

struct EmergencyTopicModel: Identifiable, Hashable {
    let id: UUID
    let title: String
    let icon: String
    let iconColor: Color
    let route: EmergencyRoute

    init(title: String, icon: String, iconColor: Color, route: EmergencyRoute) {
        self.id = UUID()
        self.title = title
        self.icon = icon
        self.iconColor = iconColor
        self.route = route
    }

    func hash(into hasher: inout Hasher) { hasher.combine(id) }
    static func == (lhs: EmergencyTopicModel, rhs: EmergencyTopicModel) -> Bool { lhs.id == rhs.id }
}

enum EmergencyRoute: Hashable {
    case dogCPR
    case choking
    case drowning
    case bloat
    case anaphylaxis

    case bleedingControl
    case fractures
    case hitByCar
    case temperatureBurns
    case electricShock
    case eyeInjuries

    case poisonExposure
    case plantPoisoning
    case foodPoisoning
    case snakeBitesStings

    case seizures
    case heatstroke
    case frostbiteHypothermia
    case blueGums
    case breathingDifficulty
    case urinaryBlockage

    case pregnancyWhelping
    case vomiting
}

struct EmergencySection: Identifiable {
    let id = UUID()
    let title: String
    let topics: [EmergencyTopicModel]
}

enum EmergencyTopicCatalog {

    static let lifeThreatening: [EmergencyTopicModel] = [
        .init(title: "Dog CPR", icon: "heart.fill", iconColor: .red, route: .dogCPR),
        .init(title: "Choking", icon: "wind", iconColor: .orange, route: .choking),
        .init(title: "Bloat (GDV)", icon: "multiply.circle.fill", iconColor: .red, route: .bloat),
        .init(title: "Anaphylaxis", icon: "waveform.path.ecg", iconColor: .purple, route: .anaphylaxis),
        .init(title: "Drowning", icon: "drop.fill", iconColor: .blue, route: .drowning)
    ]

    static let traumaAndInjury: [EmergencyTopicModel] = [
        .init(title: "Bleeding Control", icon: "bandage.fill", iconColor: .red, route: .bleedingControl),
        .init(title: "Fractures & Sprains", icon: "staroflife.fill", iconColor: .brown, route: .fractures),
        .init(title: "Hit By Car", icon: "car.fill", iconColor: .purple, route: .hitByCar),
        .init(title: "Burns & Temperature Injury", icon: "thermometer.sun.fill", iconColor: .orange, route: .temperatureBurns),
        .init(title: "Electric Shock", icon: "bolt.fill", iconColor: .yellow, route: .electricShock),
        .init(title: "Eye Injuries", icon: "eye.trianglebadge.exclamationmark.fill", iconColor: .red, route: .eyeInjuries)
    ]

    static let toxinsAndIngestion: [EmergencyTopicModel] = [
        .init(title: "Poison Exposure", icon: "exclamationmark.triangle.fill", iconColor: .purple, route: .poisonExposure),
        .init(title: "Plant Poisoning", icon: "leaf.fill", iconColor: .green, route: .plantPoisoning),
        .init(title: "Food Poisoning", icon: "pills.fill", iconColor: .purple, route: .foodPoisoning),
        .init(title: "Snake Bites & Stings", icon: "ant.fill", iconColor: .red, route: .snakeBitesStings)
    ]

    static let criticalSymptoms: [EmergencyTopicModel] = [
        .init(title: "Seizures", icon: "brain.head.profile", iconColor: .pink, route: .seizures),
        .init(title: "Heatstroke", icon: "flame.fill", iconColor: .orange, route: .heatstroke),
        .init(title: "Frostbite & Hypothermia", icon: "snowflake", iconColor: .blue, route: .frostbiteHypothermia),
        .init(title: "Blue Gums", icon: "lungs.fill", iconColor: .blue, route: .blueGums),
        .init(title: "Breathing Difficulty", icon: "waveform.path", iconColor: .cyan, route: .breathingDifficulty),
        .init(title: "Urinary Blockage", icon: "exclamationmark.triangle.fill", iconColor: .red, route: .urinaryBlockage)
    ]

    static let careAndWhelping: [EmergencyTopicModel] = [
        .init(title: "Pregnancy & Whelping", icon: "heart.circle.fill", iconColor: .pink, route: .pregnancyWhelping),
        .init(title: "Minor Vomiting", icon: "cross.vial.fill", iconColor: .blue, route: .vomiting)
    ]

    static let sections: [EmergencySection] = [
        EmergencySection(title: "Life-Threatening", topics: lifeThreatening),
        EmergencySection(title: "Trauma & Injury", topics: traumaAndInjury),
        EmergencySection(title: "Toxins & Ingestion", topics: toxinsAndIngestion),
        EmergencySection(title: "Critical Symptoms", topics: criticalSymptoms),
        EmergencySection(title: "Care & Whelping", topics: careAndWhelping)
    ]

    static let allTopics: [EmergencyTopicModel] = sections.flatMap(\.topics)
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/Anaphylaxis.swift =====


import SwiftUI

struct AnaphylaxisView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "CHECK FOR SWELLING",
            instruction: "Look for rapid facial swelling, hives, or sudden collapse. Check for difficulty breathing.",
            audio: "Look for sudden swelling on the face, hives, or collapse. Check if the dog is struggling to breathe.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.75, green: 0.20, blue: 0.75)
        ),
        InfoStep(
            title: "REMOVE STINGER",
            instruction: "If caused by a sting, scrape the stinger away with a credit card. DO NOT use tweezers.",
            audio: "Scrape the stinger away with a credit card. Do not use tweezers.",
            illustrationIcon: "creditcard",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "MONITOR AIRWAY",
            instruction: "Keep the dog's head elevated and monitor breathing closely. Anaphylaxis can close the airway.",
            audio: "Keep the head up and monitor breathing. The airway could close quickly.",
            illustrationIcon: "lungs.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "CALL VET NOW",
            instruction: "Transport the dog to the vet immediately for life-saving medication. This is a critical emergency.",
            audio: "Call the vet right now. Your dog needs immediate medication to open the airway.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.75, green: 0.15, blue: 0.75)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Anaphylaxis",
            paginationAccentColor: Color(red: 0.75, green: 0.20, blue: 0.75)
        )
    }
}

struct AnaphylaxisView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            AnaphylaxisView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/Bloat.swift =====


import SwiftUI

struct BloatView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "RECOGNIZE SYMPTOMS",
            instruction: "Look for a hard, swollen belly and unproductive retching. Bloat is 100% fatal without immediate surgery.",
            audio: "Look for a swollen belly and gagging without vomiting. This is a fatal emergency.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.90, green: 0.25, blue: 0.25)
        ),
        InfoStep(
            title: "EMERGENCY TRANSPORT",
            instruction: "This is a surgical emergency. Drive to the nearest emergency vet immediately.",
            audio: "This is a surgical emergency. Drive to the nearest emergency veterinarian immediately.",
            illustrationIcon: "stopwatch.fill",
            illustrationColor: Color(red: 0.95, green: 0.45, blue: 0.15)
        ),
        InfoStep(
            title: "POSITION THE DOG",
            instruction: "Lay the dog on their right side on a flat surface during transport.",
            audio: "Lay the dog on their right side for the drive to the vet.",
            illustrationIcon: "pause.circle.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "DO NOT DELAY",
            instruction: "DO NOT massage the stomach or induce vomiting. Every minute reduces survival chances.",
            audio: "Do not massage the stomach or induce vomiting. Every minute counts.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.90, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Bloat (GDV)",
            paginationAccentColor: Color(red: 0.90, green: 0.25, blue: 0.25)
        )
    }
}

struct BloatView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            BloatView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/ChokingEmergencyView.swift =====
import SwiftUI

struct InfoStep: Identifiable, EmergencyStep {
    let id = UUID()
    let title: String
    let instruction: String
    let audio: String
    let illustrationIcon: String?
    let illustrationColor: Color
    var sizeGuidance: SizeGuidance?
    var isInteractive: Bool { false }
}

struct ChokingEmergencyView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "RECOGNIZE CHOKING",
            instruction: "Look for violent coughing, gasping, or blue gums. If the dog is still moving air, let them cough.",
            audio: "Look for violent coughing or blue gums. If the dog can breathe, let them cough.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.88, green: 0.25, blue: 0.25)
        ),
        InfoStep(
            title: "INSPECT THE MOUTH",
            instruction: "Open the mouth and look for an object. NEVER perform a blind finger sweep as you may push the object deeper.",
            audio: "Open the mouth and look for an object. Do not reach blindly into the throat.",
            illustrationIcon: "mouth.fill",
            illustrationColor: Color(red: 0.95, green: 0.55, blue: 0.15)
        ),
        InfoStep(
            title: "BACK BLOWS",
            instruction: "Use the heel of your hand to deliver 4-5 sharp blows between the shoulder blades.",
            audio: "Use the heel of your hand to deliver five sharp blows between the shoulder blades.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "HEIMLICH MANEUVER",
            instruction: "Wrap arms around the waist. Pull up and forward sharply just behind the ribs.",
            audio: "Wrap your arms around the waist. Pull up and forward sharply just behind the ribs.",
            illustrationIcon: "figure.strengthtraining.traditional",
            illustrationColor: Color(red: 0.70, green: 0.25, blue: 0.25)
        ),
        InfoStep(
            title: "CHECK FOR PULSE",
            instruction: "If the dog collapses and stops breathing, begin CPR immediately.",
            audio: "If the dog collapses and stops breathing, start CPR immediately.",
            illustrationIcon: "heart.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "EMERGENCY VET NOW",
            instruction: "Seek vet care immediately even if the object is removed. Throat swelling or damage is invisible.",
            audio: "Drive to the emergency vet now. Internal throat damage is a major risk.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.88, green: 0.25, blue: 0.25)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Choking",
            paginationAccentColor: Color(red: 0.88, green: 0.25, blue: 0.25)
        )
    }
}

struct DogChokingEmergencyView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            ChokingEmergencyView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/CPR/CPRHeartBeatView.swift =====
import SwiftUI

struct CPRHeartBeatView: View {
    let bpm: Double
    let isActive: Bool
    @State private var scale: CGFloat = 1.0
    @State private var opacity: Double = 0.5

    var body: some View {
        ZStack {
            // Main Heart Icon
            Image(systemName: "heart.fill")
                .resizable()
                .scaledToFit()
                .frame(width: 80, height: 80)
                .foregroundColor(.red)
                .scaleEffect(scale)
        }
        .onChange(of: isActive) { _, newValue in
            if newValue {
                startBeating()
            } else {
                scale = 1.0
            }
        }
    }

    private func startBeating() {
        let interval = 60.0 / bpm
        withAnimation(.easeInOut(duration: interval / 2).repeatForever(autoreverses: true)) {
            scale = 1.2
        }
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/CPR/CPRPageView.swift =====
import SwiftUI

// MARK: - Backward-compatible typealias

typealias CPRPageView = EmergencyPageView<CPRStep, AnyView>

// MARK: - CPR Coordinator

@MainActor
final class CPRCoordinator: ObservableObject {

    enum Phase { case idle, compressions, breaths }

    @Published var phase: Phase = .idle
    @Published var compressionCount = 0
    @Published var breathCount = 0
    @Published var cycleCount = 0

    private let bpm: Double = 110
    private let metronome = MetronomeManager()
    private var beatTimer: Timer?

    // MARK: Public API

    func toggle() {
        if phase == .idle {
            startCompressions()
        } else {
            hardStop()
        }
    }

    func gaveBreath() {
        breathCount += 1
        if breathCount >= 2 {
            cycleCount += 1
            startCompressions()
        }
    }

    func hardStop() {
        stopTimer()
        metronome.stop()
        phase = .idle
        compressionCount = 0
        breathCount = 0
    }

    // MARK: Private

    private func startCompressions() {
        stopTimer()
        compressionCount = 0
        phase = .compressions
        metronome.start(bpm: bpm)
        let interval = 60.0 / bpm
        beatTimer = Timer.scheduledTimer(withTimeInterval: interval, repeats: true) { [weak self] _ in
            guard let self else { return }
            Task { @MainActor in
                self.compressionCount += 1
                if self.compressionCount >= 30 {
                    self.stopTimer()
                    self.metronome.stop()
                    self.breathCount = 0
                    self.phase = .breaths
                }
            }
        }
        RunLoop.main.add(beatTimer!, forMode: .common)
    }

    private func stopTimer() {
        beatTimer?.invalidate()
        beatTimer = nil
    }
}

// MARK: - CPRCycleView

struct CPRCycleView: View {

    let isPageVisible: Bool

    @StateObject private var cpr = CPRCoordinator()


    @Environment(\.stopEmergencyAudio) private var stopEmergencyAudio

    var body: some View {
        VStack(spacing: 20) {

            CPRHeartBeatView(bpm: 110, isActive: cpr.phase == .compressions)
                .frame(width: 130, height: 130)

            Group {
                switch cpr.phase {
                case .idle:
                    Text("Tap Start to begin CPR")
                        .foregroundStyle(.white.opacity(0.70))

                case .compressions:
                    VStack(spacing: 6) {
                        Text("COMPRESS")
                            .font(.system(size: 22, weight: .black))
                            .foregroundStyle(.red)
                        Text("\(cpr.compressionCount) / 30")
                            .font(.system(size: 36, weight: .bold).monospacedDigit())
                        Text("Push hard & fast â€“ 1â€“2 inches deep")
                            .font(.caption)
                            .foregroundStyle(.white.opacity(0.75))
                            .multilineTextAlignment(.center)
                    }

                case .breaths:
                    VStack(spacing: 6) {
                        Text("RESCUE BREATHS")
                            .font(.system(size: 22, weight: .black))
                            .foregroundStyle(Color(red: 0.20, green: 0.55, blue: 0.95))
                        Text("\(cpr.breathCount) / 2")
                            .font(.system(size: 36, weight: .bold).monospacedDigit())
                        Text("Close mouth â€“ breathe gently into nose")
                            .font(.caption)
                            .foregroundStyle(.white.opacity(0.75))
                            .multilineTextAlignment(.center)
                        Button("I gave a breath") { cpr.gaveBreath() }
                            .buttonStyle(.bordered)
                            .tint(.blue)
                            .padding(.top, 4)
                    }
                }
            }
            .frame(minHeight: 110)
            .animation(.easeInOut(duration: 0.25), value: cpr.phase)

            if cpr.cycleCount > 0 {
                Text("Cycles completed: \(cpr.cycleCount)")
                    .font(.footnote)
                    .foregroundStyle(.white.opacity(0.55))
            }

            Button {
                if cpr.phase == .idle {

                    stopEmergencyAudio()
                    cpr.toggle()
                } else {
                    cpr.toggle()
                }
            } label: {
                Text(cpr.phase == .idle ? "Start CPR" : "Stop CPR")
                    .font(.system(size: 18, weight: .semibold))
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(cpr.phase == .idle ? Color.green : Color.red)
                    .foregroundStyle(.white)
                    .cornerRadius(14)
            }
        }
        .padding(.horizontal, 20)
        .padding(.vertical, 12)
        .onChange(of: isPageVisible) { oldValue, newValue in
            
            if !newValue { cpr.hardStop() }
        }
        .onDisappear {

            cpr.hardStop()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/CPR/CPRStep.swift =====

import SwiftUI

// MARK: - CPRStepKind

public enum CPRStepKind {
    case info
    case cpr
}

// MARK: - CPRStep

public struct CPRStep: Identifiable, EmergencyStep {
    public let id = UUID()


    public let title: String
    public let instruction: String
    public let audio: String
    public let illustrationColor: Color
    public let sizeGuidance: SizeGuidance?


    public let kind: CPRStepKind


    public let illustrationIcon: String?


    public var isInteractive: Bool { kind == .cpr }

    
    public var isCPR: Bool { kind == .cpr }

    public init(
        title: String,
        instruction: String,
        audio: String,
        sizeGuidance: SizeGuidance? = nil,
        illustrationIcon: String? = nil,
        illustrationColor: Color,
        kind: CPRStepKind
    ) {
        self.title             = title
        self.instruction       = instruction
        self.audio             = audio
        self.sizeGuidance      = sizeGuidance
        self.illustrationIcon  = illustrationIcon
        self.illustrationColor = illustrationColor
        self.kind              = kind
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/CPR/DogCPREmergencyView.swift =====

import SwiftUI

// MARK: - DogCPREmergencyView

struct DogCPREmergencyView: View {

    private let steps: [CPRStep] = [
        CPRStep(
            title: "CALL FOR HELP",
            instruction: "Call the nearest emergency vet immediately. Put your phone on speaker so both hands are free.",
            audio: "Call the nearest emergency veterinarian immediately. Put your phone on speaker.",
            illustrationIcon: "phone.fill",
            illustrationColor: Color(red: 0.20, green: 0.65, blue: 0.40),
            kind: .info
        ),
        CPRStep(
            title: "CHECK FOR PULSE",
            instruction: "Check for breathing and feel for a heartbeat behind the left elbow. DO NOT perform CPR if the dog is breathing or has a pulse.",
            audio: "Check for breathing and feel for a heartbeat behind the left elbow. Do not perform CPR if the dog is breathing or has a pulse.",
            illustrationIcon: "heart.fill",
            illustrationColor: Color(red: 0.95, green: 0.25, blue: 0.25),
            kind: .info
        ),
        CPRStep(
            title: "POSITION THE DOG",
            instruction: "Lay the dog on their right side on a flat, firm surface. Ensure the head and neck are straight.",
            audio: "Lay the dog on their right side on a flat, firm surface. Make sure the head and neck are aligned.",
            illustrationIcon: "figure.walk",
            illustrationColor: Color(red: 0.40, green: 0.55, blue: 0.95),
            kind: .info
        ),
        CPRStep(
            title: "START CPR CYCLE",
            instruction: "Perform 30 chest compressions followed by 2 breaths. Press down 1/3 of chest depth, 100-120 times per minute.",
            audio: "Start the CPR cycle now. Give thirty compressions followed by two breaths. Push down firmly and fast.",
            sizeGuidance: SizeGuidance(
                smallDog: "Small dogs: Use one hand or two fingers.",
                largeDog: "Large dogs: Use both hands, one on top of the other."
            ),
            illustrationIcon: "timer",
            illustrationColor: Color(red: 0.95, green: 0.25, blue: 0.25),
            kind: .cpr
        ),
        CPRStep(
            title: "EMERGENCY TRANSPORT",
            instruction: "Continue CPR without stopping while someone drives you to the vet. Do not stop until a professional takes over.",
            audio: "Continue CPR while transporting the dog to the vet. Do not stop until help arrives.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15),
            kind: .info
        )
    ]

    var body: some View {
        EmergencyFlowView(steps: steps, navigationTitle: "Dog CPR") { step, isVisible in
           
            if step.isInteractive {
                CPRCycleView(isPageVisible: isVisible)
            }
        }
    }
}

// MARK: - Preview

#Preview {
    NavigationStack {
        DogCPREmergencyView()
    }
}

===== Sources/AppModule/Features/Emergency/Life-Threatening/DrowningEmergencyView.swift =====
import SwiftUI

struct DrowningEmergencyView: View {
    private let steps: [InfoStep] = [
        InfoStep(
            title: "REMOVE FROM WATER",
            instruction: "Remove your dog from the water immediately. Place them on a flat, firm surface.",
            audio: "Remove your dog from the water immediately and place them on a flat surface.",
            illustrationIcon: "drop.triangle.fill",
            illustrationColor: Color(red: 0.20, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "CLEAR AIRWAY",
            instruction: "Lift the dog's hind legs for 15-20 seconds to drain water from the lungs.",
            audio: "Lift the dog's back legs for twenty seconds to help drain water from the lungs.",
            illustrationIcon: "lungs.fill",
            illustrationColor: Color(red: 0.55, green: 0.75, blue: 0.95)
        ),
        InfoStep(
            title: "CHECK BREATHING",
            instruction: "If the dog is not breathing, begin CPR immediately. Check for a pulse behind the left elbow.",
            audio: "If the dog is not breathing, start CPR now.",
            illustrationIcon: "mouth.fill",
            illustrationColor: Color(red: 0.80, green: 0.30, blue: 0.20)
        ),
        InfoStep(
            title: "PROVIDE BREATHS",
            instruction: "Close the dog's mouth and breathe into the nose until the chest rises. Give 2 breaths every 30 compressions.",
            audio: "Hold the muzzle closed and breathe into the nose.",
            illustrationIcon: "heart.fill",
            illustrationColor: Color(red: 0.95, green: 0.25, blue: 0.25)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "Even if the dog seems fine, secondary drowning can occur later. Go to the vet immediately.",
            audio: "Go to the vet immediately as water in the lungs can cause issues hours later.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Drowning",
            paginationAccentColor: Color(red: 0.20, green: 0.55, blue: 0.85)
        )
    }
}

===== Sources/AppModule/Features/Emergency/Toxins & Injestion/FoodPoisoningView.swift =====


import SwiftUI

struct FoodPoisoningView: View {
    private let steps: [InfoStep] = [
        InfoStep(
            title: "CHECK FOR TOXICS",
            instruction: "Common toxic foods include grapes, raisins, chocolate, onions, and Xylitol (sweetener).",
            audio: "Check if the dog ate grapes, chocolate, onions, or Xylitol.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.85, green: 0.55, blue: 0.15)
        ),
        InfoStep(
            title: "IDENTIFY AMOUNT",
            instruction: "Determine how much was eaten and when. Check the packaging for the ingredient list and weight.",
            audio: "Identify the amount eaten and the time of ingestion.",
            illustrationIcon: "eye.fill",
            illustrationColor: Color(red: 0.55, green: 0.75, blue: 0.95)
        ),
        InfoStep(
            title: "DO NOT INDUCE VOMITING",
            instruction: "DO NOT induce vomiting unless specifically instructed by a veterinarian. Xylitol causes rapid blood sugar drops.",
            audio: "Do not make the dog vomit unless a vet tells you to.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.80, green: 0.30, blue: 0.20)
        ),
        InfoStep(
            title: "CALL VET",
            instruction: "Provide the approximate time of ingestion and the amount consumed. Have the dog's weight ready.",
            audio: "Call the vet with the time of ingestion and the amount eaten.",
            illustrationIcon: "phone.fill",
            illustrationColor: Color(red: 0.20, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "EMERGENCY TRANSPORT",
            instruction: "Take your dog to the vet immediately. Bring the food packaging or a sample of the food.",
            audio: "Take your dog to the emergency vet now and bring the packaging.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Food Poisoning",
            paginationAccentColor: Color(red: 0.85, green: 0.55, blue: 0.15)
        )
    }
}

===== Sources/AppModule/Features/Emergency/Toxins & Injestion/PlantPoisoningView.swift =====

import SwiftUI

struct PlantPoisoningView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "TAKE A PHOTO",
            instruction: "Identify the plant or take a clear photo of the leaves and flowers for the vet.",
            audio: "Identify the plant or take a photo of it for the veterinarian.",
            illustrationIcon: "leaf.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "REMOVE MATERIAL",
            instruction: "Gently wipe the mouth with a damp cloth to remove any remaining plant pieces.",
            audio: "Gently wipe the mouth to remove any plant pieces.",
            illustrationIcon: "hand.wave.fill",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "DO NOT INDUCE VOMITING",
            instruction: "DO NOT induce vomiting unless specifically instructed by a veterinarian.",
            audio: "Do not make the dog vomit unless a vet tells you to.",
            illustrationIcon: "xmark.circle.fill",
            illustrationColor: Color(red: 0.90, green: 0.45, blue: 0.20)
        ),
        InfoStep(
            title: "CALL POISON CONTROL",
            instruction: "Contact your vet or a pet poison hotline immediately. Have the plant photo or name ready.",
            audio: "Call your veterinarian or animal poison control immediately.",
            illustrationIcon: "phone.fill",
            illustrationColor: Color(red: 0.20, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "OBSERVE SYMPTOMS",
            instruction: "Watch for drooling, vomiting, tremors, or breathing difficulty.",
            audio: "Watch for drooling, vomiting, or tremors.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "EMERGENCY TRANSPORT",
            instruction: "Drive to the vet immediately. Bring a sample of the plant or the photo you took.",
            audio: "Go to the vet immediately and bring the plant sample or photo.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Plant Poisoning",
            paginationAccentColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    }
}

struct PlantPoisoningView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            PlantPoisoningView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Toxins & Injestion/PoisonExposureView.swift =====

import SwiftUI

struct PoisonExposureView: View {
    private let steps: [InfoStep] = [
        InfoStep(
            title: "REMOVE ACCESS",
            instruction: "Immediately move the dog away from the toxin. Prevent any further ingestion or skin contact.",
            audio: "Move your dog away from the source of poison immediately.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.95, green: 0.55, blue: 0.15)
        ),
        InfoStep(
            title: "IDENTIFY TOXIN",
            instruction: "Note the substance name and the amount ingested. Keep the packaging or label to show the vet.",
            audio: "Identify the substance and the amount eaten. Keep the packaging.",
            illustrationIcon: "eye.fill",
            illustrationColor: Color(red: 0.40, green: 0.55, blue: 0.95)
        ),
        InfoStep(
            title: "DO NOT INDUCE VOMITING",
            instruction: "DO NOT induce vomiting unless specifically instructed by a veterinarian. Some toxins cause more damage when vomited.",
            audio: "Do not make the dog vomit unless a vet tells you to. Some toxins cause more damage when vomited.",
            illustrationIcon: "xmark.octagon.fill",
            illustrationColor: Color(red: 0.85, green: 0.20, blue: 0.20)
        ),
        InfoStep(
            title: "CALL VET OR POISON CONTROL",
            instruction: "Contact your vet or a pet poison hotline immediately. Have the product packaging ready to read.",
            audio: "Call your veterinarian or animal poison control immediately.",
            illustrationIcon: "phone.fill",
            illustrationColor: Color(red: 0.20, green: 0.65, blue: 0.40)
        ),
        InfoStep(
            title: "EMERGENCY TRANSPORT",
            instruction: "Transport the dog to the vet immediately. Bring the toxin container or a sample of the substance.",
            audio: "Transport your dog to the vet now. Bring the poison container with you.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Poison Exposure",
            paginationAccentColor: Color(red: 0.95, green: 0.55, blue: 0.15)
        )
    }
}

struct DogPoisonExposureEmergencyView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            PoisonExposureView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Toxins & Injestion/SnakeBitesStingsView.swift =====
import SwiftUI

struct SnakeBitesStingsView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "RECOGNIZE SYMPTOMS",
            instruction: "Look for sudden yelping, rapid swelling, or weakness. Snake bites often cause immediate pain and bleeding.",
            audio: "Watch for sudden swelling, pain, or weakness.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.85, green: 0.20, blue: 0.20)
        ),
        InfoStep(
            title: "LIMIT MOVEMENT",
            instruction: "Keep the dog as still as possible to slow the spread of venom. Carry the dog if possible.",
            audio: "Keep your dog completely still. Carry them to the car to slow the venom.",
            illustrationIcon: "pause.circle.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.55)
        ),
        InfoStep(
            title: "DO NOT CUT OR SUCK",
            instruction: "DO NOT apply ice, do not cut the wound, and do not try to suck out venom. These actions worsen tissue damage.",
            audio: "Do not use ice or try to cut the wound. Go to the vet immediately.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.75, green: 0.35, blue: 0.35)
        ),
        InfoStep(
            title: "REMOVE COLLARS",
            instruction: "Rapid swelling can make collars or harnesses dangerous. Remove any restrictive items near the bite.",
            audio: "Remove collars or tight items immediately.",
            illustrationIcon: "scissors",
            illustrationColor: Color(red: 0.45, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "Snake bites require immediate antivenom and professional care. Drive to the vet now.",
            audio: "Go to an emergency vet immediately.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Snake Bites & Stings",
            paginationAccentColor: Color(red: 0.85, green: 0.20, blue: 0.20)
        )
    }
}

struct SnakeBitesStingsView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            SnakeBitesStingsView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Trauma & Injury/BleedingControlView.swift =====

import SwiftUI

struct BleedingControlView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "APPLY PRESSURE",
            instruction: "Use a clean cloth or bandage to apply firm, direct pressure to the wound for 5 minutes. DO NOT lift the cloth to check.",
            audio: "Use a clean cloth to apply firm pressure to the wound for five minutes.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "ELEVATE WOUND",
            instruction: "If the wound is on a limb, try to keep it elevated above the heart to slow blood flow.",
            audio: "If the wound is on a leg, try to keep it raised.",
            illustrationIcon: "arrow.up.circle.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "BANDAGE SNUGLY",
            instruction: "Wrap a bandage over the pressure cloth. Ensure it is snug but not tight enough to cut off circulation.",
            audio: "Wrap a bandage snugly over the wound.",
            illustrationIcon: "bandage.fill",
            illustrationColor: Color(red: 0.70, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "CHECK FOR SHOCK",
            instruction: "Look for pale gums, rapid breathing, or weakness. These are signs of life-threatening blood loss.",
            audio: "Watch for pale gums or rapid breathing.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "EMERGENCY TRANSPORT",
            instruction: "Transport the dog to the vet immediately. Do not wait for the bleeding to stop completely if it is severe.",
            audio: "Drive to the vet immediately for professional wound care.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Bleeding Control",
            paginationAccentColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    }
}

struct BleedingControlView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            BleedingControlView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Trauma & Injury/ElectricShockView.swift =====
import SwiftUI

struct ElectricShockView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "DISABLE POWER",
            instruction: "Do NOT touch the dog until the power source is turned off. Use a wooden stick to move wires if needed.",
            audio: "Do not touch the dog until the power is off. Use a wooden object to move any live wires.",
            illustrationIcon: "bolt.fill",
            illustrationColor: Color(red: 0.95, green: 0.75, blue: 0.20)
        ),
        InfoStep(
            title: "CHECK BREATHING",
            instruction: "Check for regular breathing and a pulse behind the left elbow. Begin CPR if the dog is not breathing.",
            audio: "Check for regular breathing and a pulse. Start CPR if needed.",
            illustrationIcon: "lungs.fill",
            illustrationColor: Color(red: 0.35, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "CHECK MOUTH",
            instruction: "Inspect the mouth for burns and check for regular breathing. Look for charred or swollen tissue.",
            audio: "Check the mouth for burns and ensure the dog is breathing.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.30, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "MONITOR LUNGS",
            instruction: "Electric shock can cause fluid to build up in the lungs hours later. Watch for coughing or gasping.",
            audio: "Watch for coughing or gasping, which can happen hours later.",
            illustrationIcon: "pause.circle.fill",
            illustrationColor: Color(red: 0.60, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "All electric shocks require an immediate veterinary exam to check for internal damage.",
            audio: "Drive to the vet immediately for a professional exam.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Electric Shock",
            paginationAccentColor: Color(red: 0.95, green: 0.75, blue: 0.20)
        )
    }
}

struct ElectricShockView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            ElectricShockView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Trauma & Injury/EyeInjuriesView.swift =====
import SwiftUI

struct EyeInjuriesView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "PREVENT RUBBING",
            instruction: "Prevent the dog from pawing or rubbing at the eye. Use an Elizabethan collar or hold their paws firmly.",
            audio: "Stop the dog from scratching or rubbing their eye.",
            illustrationIcon: "eye.trianglebadge.exclamationmark.fill",
            illustrationColor: Color(red: 0.80, green: 0.20, blue: 0.30)
        ),
        InfoStep(
            title: "FLUSH CHEMICALS",
            instruction: "If a chemical is in the eye, flush with sterile saline or plain water for 15 minutes.",
            audio: "If chemicals got into the eye, flush it with water for fifteen minutes.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.25, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "KEEP EYE MOIST",
            instruction: "If the eye is bulging or the eyelid cannot close, gently apply sterile saline or clean water to keep it moist.",
            audio: "Keep the eye moist with saline or clean water.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.60, green: 0.40, blue: 0.70)
        ),
        InfoStep(
            title: "SHIELD THE EYE",
            instruction: "Loosely cover the eye with a clean, damp cloth. DO NOT apply any pressure to the eyeball.",
            audio: "Loosely cover the eye without applying any pressure.",
            illustrationIcon: "bandage.fill",
            illustrationColor: Color(red: 0.45, green: 0.55, blue: 0.55)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "Eye injuries can lead to permanent blindness within hours. Transport the dog to the vet immediately.",
            audio: "Drive to the vet immediately to save the dog's vision.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Eye Injuries",
            paginationAccentColor: Color(red: 0.80, green: 0.20, blue: 0.30)
        )
    }
}

struct EyeInjuriesView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            EyeInjuriesView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Trauma & Injury/FracturesView.swift =====

import SwiftUI

struct FracturesView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "ASSESS INJURY",
            instruction: "Look for limping, swelling, or a visible deformity. Check if the leg dangles abnormally or won't bear weight.",
            audio: "Check for limping, swelling, or abnormal leg position.",
            illustrationIcon: "figure.walk",
            illustrationColor: Color(red: 0.95, green: 0.55, blue: 0.15)
        ),
        InfoStep(
            title: "IMMOBILIZE",
            instruction: "Prevent the dog from moving the injured limb. Do not attempt to \"reset\" the bone.",
            audio: "Prevent the dog from moving the injured leg. Do not try to fix the bone yourself.",
            illustrationIcon: "bandage.fill",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "MUZZLE IF NEEDED",
            instruction: "Even gentle dogs may bite when in severe pain. Muzzle if it does not interfere with breathing.",
            audio: "Use a muzzle if the dog is in pain, but only if they can breathe easily.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.75, green: 0.35, blue: 0.35)
        ),
        InfoStep(
            title: "PREVENT DAMAGE",
            instruction: "Carry the dog or use a sling to prevent them from putting weight on the injury. No jumping or stairs.",
            audio: "Carry the dog to the car. Do not let them walk on the injury.",
            illustrationIcon: "hand.point.up.fill",
            illustrationColor: Color(red: 0.40, green: 0.65, blue: 0.90)
        ),
        InfoStep(
            title: "CHECK FOR BLEEDING",
            instruction: "If the bone has broken the skin, apply a clean bandage loosely to prevent contamination.",
            audio: "If there is an open wound, cover it loosely with a clean cloth.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "All fractures require X-rays and professional treatment immediately. Drive to the vet now.",
            audio: "Go to the vet immediately for X-rays and pain relief.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.88, green: 0.25, blue: 0.25)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Fractures & Sprains",
            paginationAccentColor: Color(red: 0.95, green: 0.55, blue: 0.15) 
        )
    }
}

struct FracturesView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            FracturesView()
        }
    }
}

===== Sources/AppModule/Features/Emergency/Trauma & Injury/HitbyCar.swift =====


import SwiftUI

struct HitByCarView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "SECURE THE SCENE",
            instruction: "Ensure the area is safe from traffic. Approach the dog slowly from the front to avoid startling them.",
            audio: "Make sure the area is safe. Approach the dog slowly and calmly.",
            illustrationIcon: "exclamationmark.triangle.fill",
            illustrationColor: Color(red: 0.65, green: 0.25, blue: 0.85)
        ),
        InfoStep(
            title: "SPINE SAFETY",
            instruction: "Slide the dog onto a flat board or use a blanket as a stretcher to prevent spinal movement.",
            audio: "Use a flat board or a blanket to move the dog. Keep the spine as straight as possible.",
            illustrationIcon: "figure.wave.circle",
            illustrationColor: Color(red: 0.95, green: 0.65, blue: 0.20)
        ),
        InfoStep(
            title: "CONTROL BLEEDING",
            instruction: "Apply firm, direct pressure to any visible wounds with a clean cloth. Do not lift the cloth to check.",
            audio: "Apply firm pressure to any bleeding wounds.",
            illustrationIcon: "bandage.fill",
            illustrationColor: Color(red: 0.82, green: 0.22, blue: 0.28)
        ),
        InfoStep(
            title: "MANAGE SHOCK",
            instruction: "Keep the dog warm with a blanket. Keep their head slightly lower than the rest of their body.",
            audio: "Keep the dog warm with a blanket and keep their head low.",
            illustrationIcon: "figure.walk",
            illustrationColor: Color(red: 0.70, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "Internal injuries are often invisible. Transport the dog to a trauma center immediately.",
            audio: "Drive to the vet immediately. Internal injuries are a major risk.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.65, green: 0.15, blue: 0.85)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Dog Hit By Car",
            paginationAccentColor: Color(red: 0.65, green: 0.25, blue: 0.85)
        )
    }
}

struct HitByCarView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
            HitByCarView()
        }
    }
}


===== Sources/AppModule/Features/Emergency/Trauma & Injury/TemperatureBurnsView.swift =====

import SwiftUI

struct TemperatureBurnsView: View {

    private let steps: [InfoStep] = [
        InfoStep(
            title: "COOL WATER FLUSH",
            instruction: "Flush the burn with cool (not cold) running water for 10â€“20 minutes.",
            audio: "Flush the burn with cool running water for at least ten minutes.",
            illustrationIcon: "drop.fill",
            illustrationColor: Color(red: 0.30, green: 0.55, blue: 0.85)
        ),
        InfoStep(
            title: "NO OINTMENTS",
            instruction: "DO NOT apply butter, oils, or ointments to the burn. These trap heat and worsen the injury.",
            audio: "Do not apply any creams or oils. Cover the area with a clean, damp cloth.",
            illustrationIcon: "xmark.octagon.fill",
            illustrationColor: Color(red: 0.85, green: 0.20, blue: 0.20)
        ),
        InfoStep(
            title: "COVER LOOSELY",
            instruction: "Cover the burn loosely with a clean, damp cloth or sterile gauze. Do not wrap it tightly.",
            audio: "Cover the burn loosely with a clean, damp cloth.",
            illustrationIcon: "bandage.fill",
            illustrationColor: Color(red: 0.70, green: 0.55, blue: 0.75)
        ),
        InfoStep(
            title: "PREVENT LICKING",
            instruction: "Do not let the dog lick or bite at the burned area. Use a muzzle or Elizabethan collar if necessary.",
            audio: "Stop the dog from licking or biting the burn.",
            illustrationIcon: "hand.raised.fill",
            illustrationColor: Color(red: 0.95, green: 0.45, blue: 0.20)
        ),
        InfoStep(
            title: "EMERGENCY VET CARE",
            instruction: "All major burns require immediate veterinary treatment for pain relief and to prevent infection.",
            audio: "Drive to the vet immediately for professional burn care.",
            illustrationIcon: "cross.case.fill",
            illustrationColor: Color(red: 0.85, green: 0.15, blue: 0.15)
        )
    ]

    var body: some View {
        EmergencyFlowView(
            steps: steps,
            navigationTitle: "Temperature & Burns",
            paginationAccentColor: Color(red: 0.90, green: 0.35, blue: 0.25)
        )
    }
}

struct TemperatureBurnsView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationStack {
        TemperatureBurnsView()
        }
    }
}

===== Sources/AppModule/Features/SearchBar/EmergencyIntentResolver.swift =====
import Foundation
import NaturalLanguage

enum EmergencyIntent: Hashable {
    case dogCPR
    case choking
    case drowning
    case bloat
    case anaphylaxis

    case bleeding
    case fractures
    case hitByCar
    case temperature
    case electricShock
    case eyeInjuries

    case poisonExposure
    case plantPoisoning
    case foodPoisoning
    case snakeBitesStings

    case seizures
    case heatstroke
    case frostbiteHypothermia
    case blueGums
    case breathingDifficulty

    case urinaryBlockage
    case pregnancy
    case vomiting
}

struct EmergencyIntentResolver {

    private static let keywordMap: [EmergencyIntent: [String]] = [
        .dogCPR: ["not breathing", "no heartbeat", "collapsed", "unconscious", "cpr"],
        .choking: ["choking", "stuck", "object in throat", "can't breathe"],
        .drowning: ["drowning", "fell in water", "pulled from water", "pool", "river"],
        .bloat: ["bloat", "gdv", "swollen belly", "retching", "distended abdomen"],
        .anaphylaxis: ["anaphylaxis", "allergic reaction", "facial swelling", "hives"],

        .bleeding: ["bleeding", "blood", "cut", "wound", "hemorrhage"],
        .fractures: ["fracture", "broken leg", "limping", "sprain"],
        .hitByCar: ["hit by car", "accident", "road injury"],
        .temperature: ["burn", "heatstroke", "overheated", "hypothermia", "temperature"],
        .electricShock: ["electric shock", "electrocuted", "chewed wire", "power cord"],
        .eyeInjuries: ["eye injury", "bulging eye", "scratched eye", "eye bleeding"],

        .poisonExposure: ["poison", "chemical", "antifreeze", "rat poison"],
        .plantPoisoning: ["plant", "toxic plant", "leaf", "flower"],
        .foodPoisoning: ["chocolate", "grapes", "raisins", "xylitol", "ate something"],
        .snakeBitesStings: ["snake bite", "snake", "bee sting", "wasp", "insect sting"],

        .seizures: ["seizure", "convulsions", "fits"],
        .heatstroke: ["heatstroke", "overheated", "excessive panting"],
        .frostbiteHypothermia: ["frostbite", "freezing", "hypothermia", "cold"],
        .blueGums: ["blue gums", "purple gums", "cyanosis"],
        .breathingDifficulty: ["coughing", "gagging", "retching"],

        .urinaryBlockage: ["cannot pee", "straining to urinate", "urinary blockage"],
        .pregnancy: ["pregnant", "labor", "whelping"],
        .vomiting: ["vomiting", "threw up", "nausea"]
    ]

    static func resolve(from input: String) -> EmergencyIntent? {
        let normalized = normalize(input)
        for (intent, keywords) in keywordMap {
            if keywords.contains(where: { normalized.contains($0) }) {
                return intent
            }
        }
        return nil
    }

    static func route(for intent: EmergencyIntent) -> EmergencyRoute {
        switch intent {
        case .dogCPR:               return .dogCPR
        case .choking:              return .choking
        case .drowning:             return .drowning
        case .bloat:                return .bloat
        case .anaphylaxis:          return .anaphylaxis

        case .bleeding:             return .bleedingControl
        case .fractures:            return .fractures
        case .hitByCar:             return .hitByCar
        case .temperature:          return .temperatureBurns
        case .electricShock:        return .electricShock
        case .eyeInjuries:          return .eyeInjuries

        case .poisonExposure:       return .poisonExposure
        case .plantPoisoning:       return .plantPoisoning
        case .foodPoisoning:        return .foodPoisoning
        case .snakeBitesStings:     return .snakeBitesStings

        case .seizures:             return .seizures
        case .heatstroke:           return .heatstroke
        case .frostbiteHypothermia: return .frostbiteHypothermia
        case .blueGums:             return .blueGums
        case .breathingDifficulty:  return .breathingDifficulty

        case .urinaryBlockage:      return .urinaryBlockage
        case .pregnancy:            return .pregnancyWhelping
        case .vomiting:             return .vomiting
        }
    }

    private static func normalize(_ input: String) -> String {
        let tagger = NLTagger(tagSchemes: [.lemma])
        tagger.string = input.lowercased()
        var result = ""
        tagger.enumerateTags(in: input.startIndex..<input.endIndex, unit: .word, scheme: .lemma) { tag, range in
            if let lemma = tag?.rawValue {
                result.append(lemma)
                result.append(" ")
            }
            return true
        }
        return result.trimmingCharacters(in: .whitespaces)
    }
}

===== Sources/AppModule/SharedUI/ConfettiView.swift =====

import SwiftUI
import UIKit

struct ConfettiView: UIViewRepresentable {
    func makeUIView(context: Context) -> UIView {
        let view = UIView()
        DispatchQueue.main.async {
            showConfetti(on: view)
        }
        return view
    }

    func updateUIView(_ uiView: UIView, context: Context) {}

    private func showConfetti(on view: UIView) {
        let confettiLayer = CAEmitterLayer()
        confettiLayer.emitterPosition = CGPoint(x: view.bounds.midX, y: -10)
        confettiLayer.emitterShape = .line
        confettiLayer.emitterSize = CGSize(width: view.bounds.width, height: 2)

        let colors: [UIColor] = [
            .systemRed, .systemBlue, .systemGreen,
            .systemOrange, .systemPurple, .systemYellow, .systemPink
        ]

        confettiLayer.emitterCells = colors.map { color in
            let cell = CAEmitterCell()
            cell.birthRate = 6
            cell.lifetime = 6
            cell.velocity = 180
            cell.velocityRange = 60
            cell.emissionLongitude = .pi
            cell.emissionRange = .pi / 4
            cell.spin = 3
            cell.spinRange = 4
            cell.scale = 0.05
            cell.scaleRange = 0.03
            cell.color = color.cgColor
            cell.contents = defaultConfettiImage().cgImage
            return cell
        }

        view.layer.addSublayer(confettiLayer)

        DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
            confettiLayer.birthRate = 0
        }
    }

    private func defaultConfettiImage() -> UIImage {
        let size = CGSize(width: 32, height: 20)
        let renderer = UIGraphicsImageRenderer(size: size)

        return renderer.image { context in
            let ctx = context.cgContext
            ctx.setFillColor(UIColor.white.cgColor)

            if Bool.random() {
                ctx.fill(CGRect(origin: .zero, size: size))
            } else {
                let radius = min(size.width, size.height) / 2
                let center = CGPoint(x: size.width / 2, y: size.height / 2)
                ctx.addArc(
                    center: center,
                    radius: radius,
                    startAngle: 0,
                    endAngle: .pi * 2,
                    clockwise: false
                )
                ctx.fillPath()
            }
        }
    }
}

===== Sources/AppModule/SharedUI/InfoBanner.swift =====

import SwiftUI

struct InfoBanner: View {
    let text: String

    var body: some View {
        Text(text)
            .font(.system(size: 16, weight: .medium))
            .padding()
            .frame(maxWidth: .infinity, alignment: .leading)
            .background(Color.blue.opacity(0.2))
            .cornerRadius(14)
    }
}

===== Sources/AppModule/SharedUI/SectionCard.swift =====

import SwiftUI

struct SectionCard<Content: View>: View {
    let content: Content

    init(@ViewBuilder content: () -> Content) {
        self.content = content()
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 12) {
            content
        }
        .padding()
        .background(Color.red.opacity(0.08))
        .cornerRadius(18)
    }
}

